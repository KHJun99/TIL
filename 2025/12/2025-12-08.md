# 2025-12-05 TIL

# ✅ 오늘 한 일
- Pinia 상태 관리 라이브러리 학습
- Pinia를 활용한 Todo CRUD 애플리케이션 구현
- pinia-plugin-persistedstate를 통한 상태 영속성 관리
- Local Storage를 활용한 데이터 유지

# 📚 배운 점
- Props와 Emit만으로 상태를 관리할 때 컴포넌트 구조가 깊어지면 관리가 매우 복잡해지고 유지보수가 어려워진다
- Pinia는 중앙 집중식 상태 관리를 통해 컴포넌트 계층 구조에 관계없이 데이터에 접근할 수 있게 해준다
- state, getters, actions의 역할이 각각 ref(), computed(), methods와 유사하다는 점을 이해했다
- Local Storage를 활용하면 브라우저를 새로고침해도 데이터가 유지된다

# 📌 핵심 개념
- **Pinia**: Vue의 공식 상태 관리 라이브러리로, 여러 컴포넌트가 공유하는 상태를 중앙 저장소(store)에서 관리
- **defineStore()**: 중앙 저장소를 정의하는 함수로, 고유 ID와 함께 store를 생성
- **state**: ref()로 정의된 반응형 데이터로, 앱 구동에 필요한 기본 데이터를 저장
- **getters**: computed()로 정의되며, state를 기반으로 한 계산된 값(캐싱 기능 포함)
- **actions**: state를 변경하는 메서드로, 비즈니스 로직 포함 가능
- **단방향 데이터 흐름**: 상태(State) → 뷰(View) → 기능(Actions) → 상태로 이어지는 순환 구조
- **pinia-plugin-persistedstate**: Pinia 상태를 Local Storage에 자동 저장하여 새로고침 시에도 데이터 유지

# 💡 예시 코드

```javascript
// stores/counter.js - Store 정의
import { ref, computed } from 'vue'
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', () => {
  let id = 0
  
  // state: 반응형 상태 데이터
  const todos = ref([
    { id: id++, text: '할 일 1', isDone: false },
    { id: id++, text: '할 일 2', isDone: false }
  ])
  
  // getters: 계산된 값
  const doneTodosCount = computed(() => {
    return todos.value.filter(todo => todo.isDone).length
  })
  
  // actions: 상태를 변경하는 메서드
  const addTodo = function (todoText) {
    todos.value.push({
      id: id++,
      text: todoText,
      isDone: false
    })
  }
  
  const deleteTodo = function (selectedId) {
    todos.value = todos.value.filter(todo => todo.id !== selectedId)
  }
  
  const updateTodo = function (selectedId) {
    todos.value = todos.value.map(todo => {
      if (todo.id === selectedId) {
        todo.isDone = !todo.isDone
      }
      return todo
    })
  }
  
  return { todos, doneTodosCount, addTodo, deleteTodo, updateTodo }
}, { persist: true })  // Local Storage에 상태 저장
```

```javascript
// 컴포넌트에서 Store 사용
import { useCounterStore } from '@/stores/counter'

const store = useCounterStore()

// state 접근
console.log(store.todos)

// getters 접근
console.log(store.doneTodosCount)

// actions 호출
store.addTodo('새로운 할 일')
store.deleteTodo(1)
store.updateTodo(2)
```

```javascript
// main.js - pinia-plugin-persistedstate 설정
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'
import App from './App.vue'

const app = createApp(App)
const pinia = createPinia()

pinia.use(piniaPluginPersistedstate)
app.use(pinia)
app.mount('#app')
```

# 🛠️ 이슈 & 해결
| 🐞 문제 상황 | 🔍 원인 | 💡 해결 방법 |
|--------------|--------|--------------|
| 체크박스 상태 변경이 store에 반영되지 않음 | watch를 사용하지 않아 isDone 변경을 감지하지 못함 | watch를 통해 isDone 변경을 감지하고 updateTodo 호출 |
| 새로고침 시 todo 데이터가 초기화됨 | Pinia state는 메모리에만 저장되어 새로고침 시 사라짐 | pinia-plugin-persistedstate를 설치하고 persist: true 옵션 추가 |
| store의 action을 직접 호출하지 않고 컴포넌트 메서드를 만드는 이유 | action 호출 전후로 추가 로직 처리 필요 | 컴포넌트에서 wrapper 함수를 만들어 form reset 등 추가 로직 구현 |