# 2025-12-09 TIL

# ✅ 오늘 한 일
- Django REST Framework와 Vue.js 연동 학습
- CORS Policy 개념 학습 및 django-cors-headers 설정
- Axios를 활용한 비동기 HTTP 통신 구현
- Pinia store에서 DRF API 데이터 요청 및 응답 처리
- 게시글 전체 조회, 단일 조회, 생성 기능 구현

# 📚 배운 점
- 웹 브라우저의 동일 출처 정책(SOP)으로 인해 기본적으로 다른 출처의 리소스 요청이 차단됨
- CORS는 서버가 특정 출처의 요청을 허용하도록 설정하는 정책으로, Access-Control-Allow-Origin 헤더를 통해 구현
- Django에서는 django-cors-headers 라이브러리로 간편하게 CORS 설정 가능
- Pinia의 actions에서 axios를 사용해 DRF 서버와 통신하고, 응답 데이터를 state에 저장
- onMounted 훅을 활용하면 컴포넌트 렌더링 시 자동으로 데이터를 불러올 수 있음
- useRoute()로 동적 라우팅의 파라미터를 가져와 단일 게시글 조회 구현
- v-model을 통한 양방향 바인딩으로 폼 데이터를 관리하고, POST 요청으로 게시글 생성

# 📌 핵심 개념
- **SOP (Same-Origin Policy)**: 같은 출처(Protocol + Host + Port)에서만 리소스 접근을 허용하는 브라우저 보안 정책
- **CORS (Cross-Origin Resource Sharing)**: 서버가 다른 출처의 요청을 허용하도록 하는 메커니즘
- **Origin**: URL의 Protocol, Host, Port를 모두 포함한 출처 개념
- **django-cors-headers**: Django에서 CORS 응답 헤더를 쉽게 추가할 수 있는 라이브러리
- **Axios**: Promise 기반의 HTTP 클라이언트로 DRF API와 통신
- **Pinia actions**: 비동기 작업을 처리하고 state를 변경하는 함수들

# 💡 예시 코드

**Django CORS 설정**
```python
# settings.py
INSTALLED_APPS = [
    'corsheaders',
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware',
]

CORS_ALLOWED_ORIGINS = [
    'http://127.0.0.1:5173',
    'http://localhost:5173',
]
```

**Pinia Store에서 DRF 데이터 요청**
```javascript
// stores/articles.js
import axios from 'axios'
import { ref } from 'vue'
import { defineStore } from 'pinia'

export const useArticleStore = defineStore('article', () => {
  const articles = ref([])
  const API_URL = 'http://127.0.0.1:8000'

  const getArticles = function () {
    axios({
      method: 'get',
      url: `${API_URL}/api/v1/articles/`
    })
      .then(res => {
        articles.value = res.data
      })
      .catch(err => console.log(err))
  }

  return { articles, API_URL, getArticles }
}, { persist: true })
```

**단일 게시글 조회**
```javascript
// views/DetailView.vue
import { onMounted, ref } from 'vue'
import { useRoute } from 'vue-router'
import { useArticleStore } from '@/stores/articles'

const store = useArticleStore()
const route = useRoute()
const article = ref(null)

onMounted(() => {
  axios({
    method: 'get',
    url: `${store.API_URL}/api/v1/articles/${route.params.id}/`,
  })
  .then(res => {
    article.value = res.data
  })
  .catch(err => console.log(err))
})
```

**게시글 작성**
```javascript
// views/CreateView.vue
import { useRouter } from 'vue-router'

const title = ref(null)
const content = ref(null)
const router = useRouter()

const createArticle = function () {
  axios({
    method: 'post',
    url: `${store.API_URL}/api/v1/articles/`,
    data: {
      title: title.value,
      content: content.value
    }
  })
  .then(() => {
    router.push({ name: 'ArticleView' })
  })
  .catch(err => console.log(err))
}
```

# 🛠️ 이슈 & 해결
| 🐞 문제 상황 | 🔍 원인 | 💡 해결 방법 |
|--------------|--------|--------------|
| Vue에서 DRF API 요청 시 CORS 에러 발생 | 브라우저의 SOP로 인해 다른 출처(localhost:5173 → 127.0.0.1:8000)의 요청이 차단됨 | Django에 django-cors-headers 설치 후 CORS_ALLOWED_ORIGINS에 Vue 개발 서버 주소 등록 |
| DRF 서버는 200 OK 응답했으나 브라우저에서 데이터 접근 불가 | Access-Control-Allow-Origin 헤더가 없어 브라우저가 응답을 거부 | corsheaders 미들웨어 등록 및 허용 출처 설정으로 응답 헤더에 CORS 정보 포함 |