# 2025-12-11 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- Vueì™€ DRF ì—°ë™í•œ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶• (íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ)
- Piniaë¥¼ í™œìš©í•œ í† í° ê¸°ë°˜ ì¸ì¦ ìƒíƒœ ê´€ë¦¬
- Navigation Guardë¥¼ ì´ìš©í•œ í˜ì´ì§€ ì ‘ê·¼ ì œì–´
- dj-rest-authì˜ RegisterSerializer ì»¤ìŠ¤í„°ë§ˆì´ì§•
- User ëª¨ë¸ì— ì¶”ê°€ í•„ë“œ(age) êµ¬í˜„

# ğŸ“š ë°°ìš´ ì 
- DRFì—ì„œ ë°œê¸‰ë°›ì€ í† í°ì„ Pinia storeì— ì €ì¥í•˜ê³ , ì¸ì¦ì´ í•„ìš”í•œ ëª¨ë“  ìš”ì²­ì˜ Authorization í—¤ë”ì— í¬í•¨ì‹œì¼œ 401 Unauthorized ì˜¤ë¥˜ë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤
- Vue Routerì˜ beforeEach ì „ì—­ ë„¤ë¹„ê²Œì´ì…˜ ê°€ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ í˜ì´ì§€ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤
- dj-rest-authì˜ ê¸°ë³¸ RegisterSerializerë¥¼ ìƒì†ë°›ì•„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ë©´ íšŒì›ê°€ì… ì‹œ ì¶”ê°€ í•„ë“œë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤
- Piniaì˜ computedë¥¼ í™œìš©í•´ í† í° ì¡´ì¬ ì—¬ë¶€ë¡œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤

# ğŸ“Œ í•µì‹¬ ê°œë…
- **í† í° ê¸°ë°˜ ì¸ì¦**: DRF ë¡œê·¸ì¸ ì‹œ ë°œê¸‰ë°›ì€ í† í°ì„ Pinia stateì— ì €ì¥í•˜ê³ , ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ë§ˆë‹¤ `Authorization: Token <key>` í˜•ì‹ìœ¼ë¡œ í—¤ë”ì— í¬í•¨
- **Navigation Guard**: `router.beforeEach()`ë¥¼ í†µí•´ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼ ì°¨ë‹¨, ì¸ì¦ëœ ì‚¬ìš©ìì˜ íšŒì›ê°€ì…/ë¡œê·¸ì¸ í˜ì´ì§€ ì ‘ê·¼ ì°¨ë‹¨
- **RegisterSerializer ì»¤ìŠ¤í„°ë§ˆì´ì§•**: dj-rest-authì˜ ê¸°ë³¸ Serializerë¥¼ ìƒì†ë°›ì•„ `get_cleaned_data()`ì™€ `save()` ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬ ì¶”ê°€ í•„ë“œ ì²˜ë¦¬
- **isLogin computed**: í† í° ì¡´ì¬ ì—¬ë¶€(`token.value ? true : false`)ë¡œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ê³„ì‚°í•˜ì—¬ ë°˜ì‘í˜•ìœ¼ë¡œ ê´€ë¦¬

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ

```javascript
// stores/accounts.js - í† í° ì €ì¥ ë° ë¡œê·¸ì¸ ìƒíƒœ ê´€ë¦¬
export const useAccountStore = defineStore('account', () => {
  const token = ref(null)
  const router = useRouter()

  // ë¡œê·¸ì¸ ìƒíƒœë¥¼ computedë¡œ ê´€ë¦¬
  const isLogin = computed(() => {
    return token.value ? true : false
  })

  // ë¡œê·¸ì¸ ì•¡ì…˜
  const login = function (payload) {
    axios({
      method: 'post',
      url: `${API_URL}/accounts/login/`,
      data: {
        username: payload.username,
        password: payload.password
      }
    })
      .then(res => {
        token.value = res.data.key
        router.push({ name: 'ArticleView' })
      })
      .catch(err => console.log(err))
  }

  // íšŒì›ê°€ì… í›„ ìë™ ë¡œê·¸ì¸
  const signUp = function (payload) {
    axios({
      method: 'post',
      url: `${API_URL}/accounts/signup/`,
      data: {
        username: payload.username,
        password1: payload.password1,
        password2: payload.password2,
        age: payload.age
      }
    })
      .then(res => {
        const password = payload.password1
        login({ username: payload.username, password })
      })
      .catch(err => console.log(err))
  }

  return { signUp, login, token, isLogin }
}, { persist: true })
```

```javascript
// router/index.js - Navigation Guard ì„¤ì •
router.beforeEach((to, from) => {
  const accountStore = useAccountStore()

  // ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼ ì°¨ë‹¨
  if (to.name === 'ArticleView' && !accountStore.isLogin) {
    window.alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.')
    return { name: 'LogInView' }
  }

  // ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ íšŒì›ê°€ì…/ë¡œê·¸ì¸ í˜ì´ì§€ ì ‘ê·¼ ì°¨ë‹¨
  if ((to.name === 'SignUpView' || to.name === 'LogInView') && accountStore.isLogin) {
    window.alert('ì´ë¯¸ ë¡œê·¸ì¸ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.')
    return { name: 'ArticleView' }
  }
})
```

```javascript
// stores/articles.js - ì¸ì¦ëœ ìš”ì²­ ë³´ë‚´ê¸°
const getArticles = function () {
  axios({
    method: 'get',
    url: `${API_URL}/api/v1/articles/`,
    headers: {
      'Authorization': `Token ${accountStore.token}`
    }
  })
    .then(res => {
      articles.value = res.data
    })
    .catch(err => console.log(err))
}
```

```python
# accounts/serializers.py - CustomRegisterSerializer
from dj_rest_auth.registration.serializers import RegisterSerializer

class CustomRegisterSerializer(RegisterSerializer):
    age = serializers.IntegerField()

    def get_cleaned_data(self):
        data = super().get_cleaned_data()
        data['age'] = self.validated_data.get('age')
        return data

    def save(self, request):
        user = super().save(request)
        user.age = self.validated_data.get('age')
        user.save()
        return user
```

```python
# settings.py - ì»¤ìŠ¤í…€ Serializer ì„¤ì •
REST_AUTH = {
    'REGISTER_SERIALIZER': 'accounts.serializers.CustomRegisterSerializer',
}
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| ê²Œì‹œê¸€ ì¡°íšŒ ì‹œ 401 Unauthorized ì˜¤ë¥˜ ë°œìƒ | DRFì— ê¶Œí•œ ì„¤ì •ì„ ì¶”ê°€í–ˆì§€ë§Œ ìš”ì²­ ì‹œ ì¸ì¦ í† í°ì„ ë³´ë‚´ì§€ ì•ŠìŒ | ë¡œê·¸ì¸ ì‹œ ë°›ì€ í† í°ì„ Pinia storeì— ì €ì¥í•˜ê³ , ëª¨ë“  ì¸ì¦ ìš”ì²­ì˜ Authorization í—¤ë”ì— `Token ${token}` í˜•ì‹ìœ¼ë¡œ í¬í•¨ |
| íšŒì›ê°€ì… ì‹œ age í•„ë“œê°€ DBì— ì €ì¥ë˜ì§€ ì•ŠìŒ | dj-rest-authì˜ ê¸°ë³¸ RegisterSerializerëŠ” username, email, passwordë§Œ ì²˜ë¦¬ | CustomRegisterSerializerë¥¼ ìƒì„±í•˜ì—¬ age í•„ë“œë¥¼ ì¶”ê°€í•˜ê³  `get_cleaned_data()`ì™€ `save()` ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë”©, settings.pyì—ì„œ REST_AUTH ì„¤ì • |
| ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼ ê°€ëŠ¥ | í˜ì´ì§€ ì ‘ê·¼ ì œì–´ ë¡œì§ì´ ì—†ìŒ | Vue Routerì˜ `beforeEach` ì „ì—­ ê°€ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ `isLogin` ìƒíƒœì— ë”°ë¼ í˜ì´ì§€ ì ‘ê·¼ ì œì–´ |