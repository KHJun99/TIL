# 2025-12-10 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- DRF(Django REST Framework)ì˜ ì¸ì¦(Authentication) ì‹œìŠ¤í…œ í•™ìŠµ
- Token ê¸°ë°˜ ì¸ì¦ êµ¬í˜„ ë° ì„¤ì •
- dj-rest-auth ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•œ ì¸ì¦ API êµ¬ì¶•
- DRFì˜ ê¶Œí•œ(Permission) ì‹œìŠ¤í…œ ì´í•´ ë° ì ìš©
- Postmanì„ í†µí•œ Token ì¸ì¦ í…ŒìŠ¤íŠ¸

# ğŸ“š ë°°ìš´ ì 
- **ì¸ì¦(Authentication)**: ìš”ì²­ì„ ë³´ë‚¸ ì‚¬ìš©ìê°€ ëˆ„êµ¬ì¸ì§€ ì‹ë³„í•˜ëŠ” ê³¼ì •ìœ¼ë¡œ, ì ‘ê·¼ í—ˆìš©/ê±°ë¶€ë¥¼ ê²°ì •í•˜ì§€ëŠ” ì•ŠìŒ
- **ê¶Œí•œ(Permission)**: ì¸ì¦ëœ ì‚¬ìš©ìê°€ íŠ¹ì • ìš”ì²­ì„ ë³´ë‚¼ ìê²©ì´ ìˆëŠ”ì§€ ê²°ì •í•˜ëŠ” ê³¼ì •
- **HTTP ì‘ë‹µ ì½”ë“œ ì°¨ì´**:
  - `401 Unauthorized`: ìœ íš¨í•œ ì¸ì¦ ìê²© ì¦ëª…ì´ ì—†ì–´ ì‚¬ìš©ìë¥¼ ì‹ë³„í•  ìˆ˜ ì—†ìŒ (ë¡œê·¸ì¸ ì•ˆ ë¨)
  - `403 Forbidden`: ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì•Œê³  ìˆì§€ë§Œ ê¶Œí•œì´ ì—†ì–´ ìš”ì²­ ê±°ë¶€ (ë¡œê·¸ì¸ì€ ëìœ¼ë‚˜ ê¶Œí•œ ì—†ìŒ)
- **Token ì¸ì¦ ë°©ì‹**: ë¡œê·¸ì¸ ì‹œ ë°œê¸‰ë°›ì€ ê³ ìœ  í† í°ì„ `Authorization` í—¤ë”ì— ë‹´ì•„ ìš”ì²­í•˜ì—¬ ì‚¬ìš©ì ì¸ì¦
- **í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ ì—­í•  ë¶„ë‹´**:
  - ë°±ì—”ë“œ(DRF): ì‚¬ìš©ì ì •ë³´ ê²€ì¦, í† í° ë°œê¸‰, ê¶Œí•œ ê·œì¹™ ì •ì˜
  - í”„ë¡ íŠ¸ì—”ë“œ(Vue): ë¡œê·¸ì¸ í¼ ì œê³µ, í† í° ì €ì¥, ìš”ì²­ ì‹œ í† í° ì „ì†¡

# ğŸ“Œ í•µì‹¬ ê°œë…
- **TokenAuthentication ì„¤ì •**
  - `settings.py`ì˜ `DEFAULT_AUTHENTICATION_CLASSES`ì—ì„œ ì „ì—­ ì„¤ì •
  - `@authentication_classes` ë°ì½”ë ˆì´í„°ë¡œ Viewë³„ ê°œë³„ ì„¤ì • ê°€ëŠ¥
  - `rest_framework.authtoken` ì•± ì¶”ê°€ ë° migrate í•„ìš”

- **dj-rest-auth ë¼ì´ë¸ŒëŸ¬ë¦¬**
  - íšŒì›ê°€ì…, ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ, ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë“± ì¸ì¦ ê´€ë ¨ API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ
  - Registration ê¸°ëŠ¥ ì‚¬ìš© ì‹œ `django-allauth` ì¶”ê°€ ì„¤ì¹˜ í•„ìš”
  - `SITE_ID = 1` ì„¤ì •ìœ¼ë¡œ ì‚¬ì´íŠ¸ ì£¼ì†Œ ì •ë³´ ê´€ë¦¬

- **ê¶Œí•œ í´ë˜ìŠ¤**
  - `IsAuthenticated`: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ í—ˆìš©
  - `IsAuthenticatedOrReadOnly`: ë¹„ì¸ì¦ ì‚¬ìš©ìëŠ” ì½ê¸°ë§Œ, ì¸ì¦ ì‚¬ìš©ìëŠ” ëª¨ë“  ì‘ì—… í—ˆìš©
  - `IsAdminUser`: ê´€ë¦¬ì ê¶Œí•œ ì‚¬ìš©ìë§Œ ì ‘ê·¼ í—ˆìš©
  - `AllowAny`: ëª¨ë“  ì‚¬ìš©ì ì ‘ê·¼ í—ˆìš© (ê¸°ë³¸ê°’)

- **ê¶Œí•œ ì„¤ì • ë°©ë²•**
  - ì „ì—­ ì„¤ì •: `settings.py`ì˜ `DEFAULT_PERMISSION_CLASSES`
  - Viewë³„ ì„¤ì •: `@permission_classes` ë°ì½”ë ˆì´í„° ì‚¬ìš©

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ

**Token ì¸ì¦ ì „ì—­ ì„¤ì •**
```python
# my_api/settings.py

INSTALLED_APPS = [
    'articles',
    'accounts',
    'rest_framework',
    'rest_framework.authtoken',  # Token ì¸ì¦ì„ ìœ„í•´ í•„ìš”
    'dj_rest_auth',
    'django.contrib.sites',
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'dj_rest_auth.registration',
]

SITE_ID = 1

REST_FRAMEWORK = {
    # Authentication
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.TokenAuthentication',
    ],
    # Permission
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.AllowAny',
    ],
}
```

**URL ì„¤ì •**
```python
# my_api/urls.py

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/', include('articles.urls')),
    path('accounts/', include('dj_rest_auth.urls')),  # ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
    path('accounts/signup/', include('dj_rest_auth.registration.urls')),  # íšŒì›ê°€ì…
]
```

**Viewì— ê¶Œí•œ ì ìš©**
```python
# articles/views.py

from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import IsAuthenticated

@api_view(['GET', 'POST'])
@permission_classes([IsAuthenticated])
def article_list(request):
    if request.method == 'GET':
        articles = Article.objects.all()
        serializer = ArticleListSerializer(articles, many=True)
        return Response(serializer.data)
    
    elif request.method == 'POST':
        serializer = ArticleSerializer(data=request.data)
        if serializer.is_valid(raise_exception=True):
            # í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ìë¥¼ ì‘ì„±ìë¡œ ì €ì¥
            serializer.save(user=request.user)
            return Response(serializer.data, status=status.HTTP_201_CREATED)
```

**Postmanì—ì„œ Token ì‚¬ìš©**
```
Headers:
Key: Authorization
Value: Token b944b89199c62bcf9af87e49ab6b137203
       â†‘ê³µë°± í•„ìˆ˜
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| ê²Œì‹œê¸€ ì¡°íšŒ ì‹œ 401 ì—ëŸ¬ ë°œìƒ | `@permission_classes([IsAuthenticated])` ì„¤ì • í›„ Token ì—†ì´ ìš”ì²­ | Authorization í—¤ë”ì— `Token <key>` í˜•ì‹ìœ¼ë¡œ ë°œê¸‰ë°›ì€ í† í° í¬í•¨í•˜ì—¬ ìš”ì²­ |
| dj-rest-auth ì„¤ì¹˜ í›„ íšŒì›ê°€ì… ê¸°ëŠ¥ ì•ˆ ë¨ | Registration ê¸°ëŠ¥ì„ ìœ„í•œ ì¶”ê°€ íŒ¨í‚¤ì§€ ë¯¸ì„¤ì¹˜ | `django-allauth` ì„¤ì¹˜ ë° ê´€ë ¨ ì•± `INSTALLED_APPS`ì— ì¶”ê°€, `SITE_ID = 1` ì„¤ì • |
| Token í—¤ë” í˜•ì‹ ì˜¤ë¥˜ | Authorization í—¤ë” ê°’ì—ì„œ 'Token'ê³¼ í† í° ê°’ ì‚¬ì´ ê³µë°± ëˆ„ë½ | `Token <key>` í˜•ì‹ìœ¼ë¡œ ê³µë°± ë°˜ë“œì‹œ í¬í•¨ (ì˜ˆ: `Token b944b89...`) |
