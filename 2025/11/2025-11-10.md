# 2025-11-10 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- N:1 ê´€ê³„ì˜ í•œê³„ ìƒí™© ì´í•´ ë° ë¬¸ì œì  íŒŒì•…
- ì¤‘ê°œ ëª¨ë¸(Intermediate Model)ì˜ ê°œë…ê³¼ í•„ìš”ì„± í•™ìŠµ
- ManyToManyFieldë¥¼ í™œìš©í•œ M:N ê´€ê³„ ì„¤ì • ì‹¤ìŠµ
- 'through' ì†ì„±ì„ ì´ìš©í•œ ì»¤ìŠ¤í…€ ì¤‘ê°œ í…Œì´ë¸” ìƒì„±
- ì—­ì°¸ì¡° ë§¤ë‹ˆì € ì¶©ëŒ ë¬¸ì œ í•´ê²° (related_name í™œìš©)
- ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„ì„ í†µí•œ M:N ê´€ê³„ ì‹¤ì „ ì ìš©
- .add()ì™€ .remove() ë©”ì„œë“œë¥¼ í™œìš©í•œ ê´€ê³„ ë°ì´í„° ì¡°ì‘
- through_defaultsë¥¼ ì´ìš©í•œ ì¤‘ê°œ í…Œì´ë¸” ì¶”ê°€ ì •ë³´ ì €ì¥

# ğŸ“š ë°°ìš´ ì 
- **N:1 ê´€ê³„ì˜ í•œê³„**: í•œ í™˜ìê°€ ì—¬ëŸ¬ ì˜ì‚¬ì—ê²Œ ì§„ë£Œë°›ìœ¼ë ¤ë©´ í™˜ì ë°ì´í„°ê°€ ì¤‘ë³µ ì €ì¥ë˜ì–´ì•¼ í•˜ëŠ” ë¬¸ì œ ë°œìƒ
- **ì œ1ì •ê·œí˜• ìœ„ë°˜**: í•˜ë‚˜ì˜ í•„ë“œì— '1, 2' í˜•íƒœë¡œ ì—¬ëŸ¬ ê°’ì„ ì €ì¥í•˜ëŠ” ê²ƒì€ DB ì„¤ê³„ ì›ì¹™ì— ìœ„ë°°
- **ì¤‘ê°œ ëª¨ë¸ì˜ ì—­í• **: ë‘ ëª¨ë¸ì„ ì—°ê²°í•˜ë©´ì„œ ê´€ê³„ ìì²´ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´(ì¦ìƒ, ì˜ˆì•½ì¼ ë“±)ë¥¼ ì €ì¥ ê°€ëŠ¥
- **ManyToManyFieldì˜ ìë™ ê¸°ëŠ¥**: Djangoê°€ ìë™ìœ¼ë¡œ ì¤‘ê°œ í…Œì´ë¸”ì„ ìƒì„±í•˜ì—¬ ê´€ê³„ ê´€ë¦¬
- **í•„ë“œ ì‘ì„± ìœ„ì¹˜ì˜ ììœ ë¡œì›€**: ManyToManyFieldëŠ” ì–´ëŠ ëª¨ë¸ì— ì •ì˜í•´ë„ ê´€ê³„ëŠ” ë™ì¼í•˜ê²Œ ìœ ì§€
- **ë³µìˆ˜í˜• ê¶Œì¥**: ManyToManyFieldì˜ í•„ë“œëª…ì€ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ë³µìˆ˜í˜• ì‘ì„± ê¶Œì¥
- **ë¬¼ë¦¬ì  ë³€í™” ì—†ìŒ**: M:N ê´€ê³„ë¡œ ë§ºì–´ì§„ ë‘ í…Œì´ë¸” ìì²´ëŠ” ë¬¼ë¦¬ì  ë³€í™”ê°€ ì—†ê³  ì¤‘ê°œ í…Œì´ë¸”ë§Œ ìƒì„±ë¨
- **ì¢…ì† ê´€ê³„ ì•„ë‹˜**: N:1ì€ ì™„ì „í•œ ì¢…ì†ì´ì§€ë§Œ M:Nì€ ì–‘ë°©í–¥ í‘œí˜„ ê°€ëŠ¥í•œ ëŒ€ë“±í•œ ê´€ê³„
- **ì—­ì°¸ì¡° ì¶©ëŒ í•´ê²°**: ê°™ì€ ë‘ ëª¨ë¸ ê°„ ì—¬ëŸ¬ ê´€ê³„(ForeignKey + ManyToManyField)ê°€ ìˆì„ ë•Œ related_nameìœ¼ë¡œ êµ¬ë¶„
- **ì„¤ê³„ ì›ì¹™**: í•µì‹¬ ì†Œìœ  ê´€ê³„(N:1)ëŠ” ê¸°ë³¸ê°’ ìœ ì§€, ë¶€ê°€ì  í–‰ìœ„ ê´€ê³„(M:N)ì— êµ¬ì²´ì  ì´ë¦„ ë¶€ì—¬

# ğŸ“Œ í•µì‹¬ ê°œë…
- **ë‹¤ëŒ€ë‹¤ ê´€ê³„(M:N)**: í•œ í…Œì´ë¸”ì˜ 0ê°œ ì´ìƒ ë ˆì½”ë“œê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ 0ê°œ ì´ìƒ ë ˆì½”ë“œì™€ ê´€ë ¨ëœ ê´€ê³„
- **ì¤‘ê°œ ëª¨ë¸(Intermediate Model)**: ë‹¤ëŒ€ë‹¤ ê´€ê³„ì—ì„œ ë‘ ëª¨ë¸ì„ ì—°ê²°í•˜ê³  ì¶”ê°€ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” íŠ¹ë³„í•œ ëª¨ë¸
- **ManyToManyField**: M:N ê´€ê³„ ì„¤ì • ëª¨ë¸ í•„ë“œ, ìë™ìœ¼ë¡œ ì¤‘ê°œ í…Œì´ë¸” ìƒì„±
- **through ì†ì„±**: ì¤‘ê°œ í…Œì´ë¸”ì— ì¶”ê°€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ M:N ê´€ê³„ë¥¼ ì •ì˜í•  ë•Œ ì‚¬ìš©
- **through_defaults**: .add() ë©”ì„œë“œì—ì„œ ì¤‘ê°œ ëª¨ë¸ì˜ ì¶”ê°€ í•„ë“œì— ê°’ì„ ì „ë‹¬í•˜ëŠ” ì¸ì
- **related_name**: ì—­ì°¸ì¡° ì‹œ ì‚¬ìš©í•  ì´ë¦„ì„ ì§€ì •í•˜ëŠ” ì†ì„±, ì¶©ëŒ ë°©ì§€ìš©
- **symmetrical**: ê´€ê³„ì˜ ë°©í–¥ì„± ì„¤ì • ì†ì„± (ê¸°ë³¸ê°’ TrueëŠ” ëŒ€ì¹­, FalseëŠ” ë¹„ëŒ€ì¹­)
- **.add() ë©”ì„œë“œ**: ì¤‘ê°œ í…Œì´ë¸”ì— ìƒˆë¡œìš´ ê´€ê³„ ë°ì´í„° ì¶”ê°€
- **.remove() ë©”ì„œë“œ**: ì¤‘ê°œ í…Œì´ë¸”ì—ì„œ ê´€ê³„ ë°ì´í„° ì‚­ì œ (ëŒ€ìƒ ê°ì²´ ìì²´ëŠ” ì‚­ì œ ì•ˆ ë¨)
- **ì¤‘ê°œ í…Œì´ë¸” ì´ë¦„ ê·œì¹™**: 'ì•±ì´ë¦„_ëª¨ë¸í´ë˜ìŠ¤ëª…_í•„ë“œëª…' í˜•ì‹ìœ¼ë¡œ ìë™ ìƒì„±
- **ì—­ì°¸ì¡° ë§¤ë‹ˆì € ì¶©ëŒ**: ForeignKeyì™€ ManyToManyFieldê°€ ê°™ì€ ëª¨ë¸ ê°„ ê³µì¡´ ì‹œ ë°œìƒ

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ

**N:1 ê´€ê³„ì˜ í•œê³„ - í™˜ìì™€ ì˜ì‚¬ ëª¨ë¸**
```python
# hospitals/models.py

class Doctor(models.Model):
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ ì˜ì‚¬ {self.name}'

class Patient(models.Model):
    # N:1 ê´€ê³„ë¡œëŠ” í•œê³„ê°€ ìˆìŒ
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE)
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ í™˜ì {self.name}'
```

**N:1 í•œê³„ ìƒí™© ì¬í˜„**
```python
# Django shell
$ python manage.py shell

# ì˜ì‚¬ ìƒì„±
doctor1 = Doctor.objects.create(name='allie')
doctor2 = Doctor.objects.create(name='barbie')

# í™˜ì ìƒì„±
patient1 = Patient.objects.create(name='carol', doctor=doctor1)
patient2 = Patient.objects.create(name='duke', doctor=doctor2)

# âŒ ë¬¸ì œ ìƒí™©: carolì´ ë‘ ì˜ì‚¬ ëª¨ë‘ì—ê²Œ ì§„ë£Œë°›ìœ¼ë ¤ë©´?
# í™˜ì ë°ì´í„°ê°€ ì¤‘ë³µìœ¼ë¡œ ì €ì¥ë¨
patient3 = Patient.objects.create(name='carol', doctor=doctor2)

# âŒ ë™ì‹œì— ë‘ ì˜ì‚¬ ì •ë³´ ì €ì¥ ì‹œë„ -> ì—ëŸ¬ ë°œìƒ
patient4 = Patient.objects.create(name='carol', doctor=doctor1, doctor2)
# SyntaxError: positional argument follows keyword argument

# ê²°ê³¼: ë°ì´í„° ì¤‘ë³µ ë°œìƒ, ì œ1ì •ê·œí˜• ìœ„ë°˜
```

**ì¤‘ê°œ ëª¨ë¸ ìƒì„± - N:1ì˜ í•œê³„ í•´ê²°**
```python
# hospitals/models.py

class Doctor(models.Model):
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ ì˜ì‚¬ {self.name}'

# Patient ëª¨ë¸ì—ì„œ ì™¸ë˜ í‚¤ ì‚­ì œ
class Patient(models.Model):
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ í™˜ì {self.name}'

# ì¤‘ê°œ ëª¨ë¸ ìƒì„±
class Reservation(models.Model):
    # ì˜ì‚¬ì™€ í™˜ìì— ê°ê° N:1 ê´€ê³„
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE)
    patient = models.ForeignKey(Patient, on_delete=models.CASCADE)
    symptom = models.TextField()  # ì¶”ê°€ ì •ë³´
    reserved_at = models.DateTimeField(auto_now_add=True)  # ì¶”ê°€ ì •ë³´
    
    def __str__(self):
        return f'{self.doctor_id}ë²ˆ ì˜ì‚¬ì˜ {self.patient_id}ë²ˆ í™˜ì'
```

**ì¤‘ê°œ ëª¨ë¸ì„ í†µí•œ ì˜ˆì•½ ìƒì„±**
```python
# Django shell
doctor1 = Doctor.objects.create(name='allie')
patient1 = Patient.objects.create(name='carol')
patient2 = Patient.objects.create(name='duke')

# ì˜ˆì•½ ìƒì„± ë°©ë²• 1: Reservation í´ë˜ìŠ¤ ì§ì ‘ ì‚¬ìš©
reservation1 = Reservation(
    doctor=doctor1, 
    patient=patient1, 
    symptom='headache'
)
reservation1.save()

# ì˜ˆì•½ ì¡°íšŒ
doctor1.patient_set.all()
# <QuerySet [<Patient: 1ë²ˆ í™˜ì carol>]>

patient1.reservation_set.all()
# <QuerySet [<Reservation: 1ë²ˆ ì˜ì‚¬ì˜ 1ë²ˆ í™˜ì>]>

# ì˜ˆì•½ ì‚­ì œ
reservation1.delete()
```

**ManyToManyField ê¸°ë³¸ ì‚¬ìš©ë²•**
```python
# hospitals/models.py

class Doctor(models.Model):
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ ì˜ì‚¬ {self.name}'

class Patient(models.Model):
    # ManyToManyField ì‘ì„± (ë³µìˆ˜í˜• ê¶Œì¥)
    doctors = models.ManyToManyField(Doctor)
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ í™˜ì {self.name}'

# Migration í›„ ìë™ ìƒì„±ë˜ëŠ” ì¤‘ê°œ í…Œì´ë¸”: hospitals_patient_doctors
# ì¤‘ê°œ í…Œì´ë¸” ì´ë¦„: 'ì•±ì´ë¦„_ëª¨ë¸í´ë˜ìŠ¤ëª…_í•„ë“œëª…'
```

**ManyToManyField ì‹¤ìŠµ**
```python
# Django shell
doctor1 = Doctor.objects.create(name='allie')
patient1 = Patient.objects.create(name='carol')
patient2 = Patient.objects.create(name='duke')

# ì˜ˆì•½ ìƒì„± (patient1ì´ doctor1ì—ê²Œ)
patient1.doctors.add(doctor1)

# ì˜ˆì•½ ì¡°íšŒ
patient1.doctors.all()
# <QuerySet [<Doctor: 1ë²ˆ ì˜ì‚¬ allie>]>

# ì—­ì°¸ì¡°ë¡œ ì¡°íšŒ
doctor1.patient_set.all()
# <QuerySet [<Patient: 1ë²ˆ í™˜ì carol>]>

# ì˜ì‚¬ê°€ í™˜ì ì¶”ê°€ (ì—­ì°¸ì¡° ë§¤ë‹ˆì € ì‚¬ìš©)
doctor1.patient_set.add(patient2)

doctor1.patient_set.all()
# <QuerySet [<Patient: 1ë²ˆ í™˜ì carol>, <Patient: 2ë²ˆ í™˜ì duke>]>

patient2.doctors.all()
# <QuerySet [<Doctor: 1ë²ˆ ì˜ì‚¬ allie>]>

# ì˜ˆì•½ ì·¨ì†Œ (ê´€ê³„ ì‚­ì œ)
patient2.doctors.remove(doctor1)

patient2.doctors.all()
# <QuerySet []>

# ì˜ì‚¬ê°€ í™˜ì ì˜ˆì•½ ì·¨ì†Œ
doctor1.patient_set.remove(patient1)

doctor1.patient_set.all()
# <QuerySet []>
```

**through ì†ì„± - ì¤‘ê°œ í…Œì´ë¸”ì— ì¶”ê°€ ì •ë³´ ì €ì¥**
```python
# hospitals/models.py

class Doctor(models.Model):
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ ì˜ì‚¬ {self.name}'

class Patient(models.Model):
    # through ì†ì„±ìœ¼ë¡œ ì»¤ìŠ¤í…€ ì¤‘ê°œ ëª¨ë¸ ì§€ì •
    doctors = models.ManyToManyField(Doctor, through='Reservation')
    name = models.TextField()
    
    def __str__(self):
        return f'{self.pk}ë²ˆ í™˜ì {self.name}'

class Reservation(models.Model):
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE)
    patient = models.ForeignKey(Patient, on_delete=models.CASCADE)
    symptom = models.TextField()  # ì¶”ê°€ í•„ë“œ
    reserved_at = models.DateTimeField(auto_now_add=True)  # ì¶”ê°€ í•„ë“œ
    
    def __str__(self):
        return f'{self.doctor.pk}ë²ˆ ì˜ì‚¬ì˜ {self.patient.pk}ë²ˆ í™˜ì'
```

**through ì†ì„± ì‚¬ìš© ì‹œ ì˜ˆì•½ ìƒì„±**
```python
# Django shell
doctor1 = Doctor.objects.create(name='allie')
patient1 = Patient.objects.create(name='carol')
patient2 = Patient.objects.create(name='duke')

# ë°©ë²• 1: Reservation í´ë˜ìŠ¤ ì§ì ‘ ì‚¬ìš©
reservation1 = Reservation(
    doctor=doctor1, 
    patient=patient1, 
    symptom='headache'
)
reservation1.save()

# ì¡°íšŒ ê°€ëŠ¥
doctor1.patient_set.all()
# <QuerySet [<Patient: 1ë²ˆ í™˜ì carol>]>

patient1.doctors.all()
# <QuerySet [<Doctor: 1ë²ˆ ì˜ì‚¬ allie>]>

# ë°©ë²• 2: through_defaults ì‚¬ìš©
patient2.doctors.add(doctor1, through_defaults={'symptom': 'flu'})

doctor1.patient_set.all()
# <QuerySet [<Patient: 1ë²ˆ í™˜ì carol>, <Patient: 2ë²ˆ í™˜ì duke>]>

patient2.doctors.all()
# <QuerySet [<Doctor: 1ë²ˆ ì˜ì‚¬ allie>]>

# ì¤‘ê°œ í…Œì´ë¸” í™•ì¸
# hospitals_reservation í…Œì´ë¸”:
# | id | symptom  | reserved_at        | doctor_id | patient_id |
# |----|----------|--------------------|-----------|------------|
# | 1  | headache | 2024-11-06...      | 1         | 1          |
# | 2  | flu      | 2024-11-06...      | 1         | 2          |

# ì˜ˆì•½ ì‚­ì œ
reservation1.delete()
# (1, {'hospitals.Reservation': 1})

# ì—­ì°¸ì¡° ë§¤ë‹ˆì €ë¡œ ì‚­ì œ
doctor1.patient_set.remove(patient2)
```

**ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„ - Article & User M:N ê´€ê³„**
```python
# articles/models.py
from django.conf import settings

class Article(models.Model):
    # N:1 ê´€ê³„: ê²Œì‹œê¸€ ì‘ì„±ì
    user = models.ForeignKey(
        settings.AUTH_USER_MODEL, 
        on_delete=models.CASCADE
    )
    # M:N ê´€ê³„: ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì‚¬ìš©ì
    like_users = models.ManyToManyField(
        settings.AUTH_USER_MODEL,
        related_name='like_articles'  # ì—­ì°¸ì¡° ì¶©ëŒ ë°©ì§€
    )
    title = models.CharField(max_length=10)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

# Migration í›„ ìë™ ìƒì„±: articles_article_like_users í…Œì´ë¸”
```

**ì—­ì°¸ì¡° ë§¤ë‹ˆì € ì¶©ëŒ ë¬¸ì œ**
```python
# âŒ ë¬¸ì œ ìƒí™©: related_name ì—†ì´ ì‘ì„±í•˜ë©´ ì¶©ëŒ ë°œìƒ
class Article(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    like_users = models.ManyToManyField(settings.AUTH_USER_MODEL)  # ì¶©ëŒ!
    # ...

# Migration ì‹œ ì—ëŸ¬:
# articles.Article.like_users: (fields.E304) Reverse accessor for 
# 'Article.like_users' clashes with reverse accessor for 'Article.user'.

# ë¬¸ì œ ì›ì¸:
# user.article_set.all() - ìœ ì €ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ (N:1)
# user.article_set.all() - ìœ ì €ê°€ ì¢‹ì•„ìš” í•œ ê²Œì‹œê¸€ (M:N) <- ì¶©ëŒ!

# âœ… í•´ê²°: related_name ì¶”ê°€
class Article(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    like_users = models.ManyToManyField(
        settings.AUTH_USER_MODEL,
        related_name='like_articles'  # ëª…í™•í•œ ì´ë¦„ìœ¼ë¡œ êµ¬ë¶„
    )
    # ...
```

**ì‚¬ìš© ê°€ëŠ¥í•œ ì „ì²´ related manager**
```python
# N:1 ê´€ê³„ (ì‘ì„±ì)
article.user  # ê²Œì‹œê¸€ì„ ì‘ì„±í•œ ìœ ì €
user.article_set.all()  # ìœ ì €ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ (ì—­ì°¸ì¡°)

# M:N ê´€ê³„ (ì¢‹ì•„ìš”)
article.like_users.all()  # ê²Œì‹œê¸€ì„ ì¢‹ì•„ìš” í•œ ìœ ì €
user.like_articles.all()  # ìœ ì €ê°€ ì¢‹ì•„ìš” í•œ ê²Œì‹œê¸€ (ì—­ì°¸ì¡°)
```

**ì¢‹ì•„ìš” ê¸°ëŠ¥ URL ë° View**
```python
# articles/urls.py
from django.urls import path
from . import views

app_name = 'articles'
urlpatterns = [
    path('', views.index, name='index'),
    path('<int:pk>/', views.detail, name='detail'),
    path('<int:article_pk>/likes/', views.likes, name='likes'),
]
```
```python
# articles/views.py
from django.shortcuts import redirect, get_object_or_404
from django.contrib.auth.decorators import login_required
from .models import Article

@login_required
def likes(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    
    # ì´ë¯¸ ì¢‹ì•„ìš” í–ˆìœ¼ë©´ ì·¨ì†Œ, ì•ˆ í–ˆìœ¼ë©´ ì¶”ê°€
    if request.user in article.like_users.all():
        article.like_users.remove(request.user)
    else:
        article.like_users.add(request.user)
    
    return redirect('articles:index')
```

**ì¢‹ì•„ìš” ê¸°ëŠ¥ í…œí”Œë¦¿**
```html
<!-- articles/index.html -->
{% for article in articles %}
  <p>ì‘ì„±ì: {{ article.user }}</p>
  <p>ì œëª©: {{ article.title }}</p>
  <p>ë‚´ìš©: {{ article.content }}</p>
  
  <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
  <form action="{% url 'articles:likes' article.pk %}" method="POST">
    {% csrf_token %}
    {% if request.user in article.like_users.all %}
      <input type="submit" value="ì¢‹ì•„ìš” ì·¨ì†Œ">
    {% else %}
      <input type="submit" value="ì¢‹ì•„ìš”">
    {% endif %}
  </form>
  
  <!-- ì¢‹ì•„ìš” ê°œìˆ˜ -->
  <p>{{ article.like_users.count }}ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤.</p>
  <hr>
{% endfor %}
```

**symmetrical ì†ì„± - íŒ”ë¡œìš° ê¸°ëŠ¥ ì˜ˆì‹œ**
```python
# accounts/models.py
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
    # ìê¸° ìì‹ ì„ ì°¸ì¡°í•˜ëŠ” M:N ê´€ê³„
    # symmetrical=False: ë¹„ëŒ€ì¹­ ê´€ê³„ (íŒ”ë¡œìš°ëŠ” ë‹¨ë°©í–¥)
    followings = models.ManyToManyField(
        'self',
        symmetrical=False,
        related_name='followers'
    )

# symmetrical=True (ê¸°ë³¸ê°’): ëŒ€ì¹­ ê´€ê³„
# Aê°€ Bë¥¼ ì¹œêµ¬ ì¶”ê°€ -> Bë„ ìë™ìœ¼ë¡œ Aë¥¼ ì¹œêµ¬ë¡œ ì¶”ê°€
# ì˜ˆ: ì¹œêµ¬ ê´€ê³„

# symmetrical=False: ë¹„ëŒ€ì¹­ ê´€ê³„
# Aê°€ Bë¥¼ íŒ”ë¡œìš° -> BëŠ” Aë¥¼ ìë™ìœ¼ë¡œ íŒ”ë¡œìš°í•˜ì§€ ì•ŠìŒ
# ì˜ˆ: íŒ”ë¡œìš° ê´€ê³„, ì¢‹ì•„ìš” ê´€ê³„
```

**M:N ê´€ê³„ ì¡°íšŒ ë° í•„í„°ë§**
```python
# íŠ¹ì • í™˜ìê°€ ì˜ˆì•½í•œ ì˜ì‚¬ ëª©ë¡
patient = Patient.objects.get(pk=1)
patient.doctors.all()

# íŠ¹ì • ì˜ì‚¬ì˜ í™˜ì ëª©ë¡ (ì—­ì°¸ì¡°)
doctor = Doctor.objects.get(pk=1)
doctor.patient_set.all()

# íŠ¹ì • ì¦ìƒìœ¼ë¡œ ì˜ˆì•½í•œ í™˜ì ì°¾ê¸°
Reservation.objects.filter(symptom='headache')

# íŠ¹ì • ì˜ì‚¬ì—ê²Œ ì˜ˆì•½í•œ í™˜ì ì¤‘ íŠ¹ì • ì¦ìƒì¸ ê²½ìš°
Reservation.objects.filter(doctor=doctor1, symptom='flu')

# íŠ¹ì • ê²Œì‹œê¸€ì„ ì¢‹ì•„ìš”í•œ ì‚¬ìš©ì ëª©ë¡
article = Article.objects.get(pk=1)
article.like_users.all()

# íŠ¹ì • ì‚¬ìš©ìê°€ ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ ëª©ë¡
user = User.objects.get(pk=1)
user.like_articles.all()

# ì¢‹ì•„ìš” ê°œìˆ˜ í™•ì¸
article.like_users.count()

# íŠ¹ì • ì‚¬ìš©ìê°€ ì¢‹ì•„ìš” í–ˆëŠ”ì§€ í™•ì¸
user in article.like_users.all()
# ë˜ëŠ”
article.like_users.filter(pk=user.pk).exists()
```

**ì‹¤ë¬´ í™œìš© ì˜ˆì‹œ**
```python
# ê°•ì˜ - í•™ìƒ M:N ê´€ê³„
class Course(models.Model):
    name = models.CharField(max_length=100)
    students = models.ManyToManyField('Student', through='Enrollment')

class Student(models.Model):
    name = models.CharField(max_length=100)

class Enrollment(models.Model):
    course = models.ForeignKey(Course, on_delete=models.CASCADE)
    student = models.ForeignKey(Student, on_delete=models.CASCADE)
    enrolled_at = models.DateTimeField(auto_now_add=True)
    grade = models.CharField(max_length=2)  # A+, A, B+ ë“±

# ê²Œì‹œê¸€ - íƒœê·¸ M:N ê´€ê³„
class Post(models.Model):
    title = models.CharField(max_length=200)
    tags = models.ManyToManyField('Tag')

class Tag(models.Model):
    name = models.CharField(max_length=50)
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| N:1 ê´€ê³„ë¡œ í•œ í™˜ìê°€ ì—¬ëŸ¬ ì˜ì‚¬ì—ê²Œ ì§„ë£Œë°›ìœ¼ë ¤ë©´ í™˜ì ë°ì´í„° ì¤‘ë³µ ì €ì¥ë¨ | Patient ëª¨ë¸ì— í•˜ë‚˜ì˜ doctor ForeignKeyë§Œ ì¡´ì¬ | Reservation ì¤‘ê°œ ëª¨ë¸ ìƒì„±í•˜ì—¬ ì˜ì‚¬-í™˜ì M:N ê´€ê³„ë¡œ ë³€ê²½ |
| Migration ì‹œ "Reverse accessor clashes" ì—ëŸ¬ ë°œìƒ | User ëª¨ë¸ê³¼ Article ëª¨ë¸ ê°„ ForeignKeyì™€ ManyToManyFieldê°€ ë™ì‹œì— ì¡´ì¬í•˜ì—¬ ì—­ì°¸ì¡° ì´ë¦„ ì¶©ëŒ | ManyToManyFieldì— `related_name='like_articles'` ì¶”ê°€í•˜ì—¬ ì—­ì°¸ì¡° ì´ë¦„ êµ¬ë¶„ |
| ManyToManyField ì‚¬ìš© ì‹œ ì˜ˆì•½ ì‹œê°„, ì¦ìƒ ë“± ì¶”ê°€ ì •ë³´ ì €ì¥ ë¶ˆê°€ | ê¸°ë³¸ ManyToManyFieldëŠ” ê´€ê³„ ì •ë³´ë§Œ ì €ì¥ | `through='Reservation'` ì†ì„±ìœ¼ë¡œ ì»¤ìŠ¤í…€ ì¤‘ê°œ ëª¨ë¸ ì§€ì •, ì¶”ê°€ í•„ë“œ ì •ì˜ |
| through ì§€ì • í›„ .add() ì‚¬ìš© ì‹œ ì¶”ê°€ í•„ë“œì— ê°’ì„ ë„£ì„ ìˆ˜ ì—†ìŒ | ê¸°ë³¸ .add()ëŠ” ê´€ê³„ë§Œ ìƒì„± | `through_defaults={'symptom': 'flu'}` ì¸ìë¡œ ì¶”ê°€ í•„ë“œ ê°’ ì „ë‹¬ |
| ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì‹œ ì¤‘ë³µ ì¢‹ì•„ìš” ë°œìƒ | ì¢‹ì•„ìš” ì—¬ë¶€ í™•ì¸ ì—†ì´ ë¬´ì¡°ê±´ .add() ì‹¤í–‰ | `if request.user in article.like_users.all()` ì¡°ê±´ë¬¸ìœ¼ë¡œ ì´ë¯¸ ì¢‹ì•„ìš” í–ˆëŠ”ì§€ í™•ì¸ í›„ .add() ë˜ëŠ” .remove() |
| related_name ì„¤ì • í›„ ê¸°ì¡´ ì½”ë“œì—ì„œ article_set ì‚¬ìš© ë¶ˆê°€ | related_name ì„¤ì • ì‹œ ê¸°ë³¸ ì—­ì°¸ì¡° ì´ë¦„ì´ ë³€ê²½ë¨ | related_nameì€ M:Nì—ë§Œ ì„¤ì •í•˜ê³  N:1ì€ ê¸°ë³¸ ì—­ì°¸ì¡° ìœ ì§€, ë˜ëŠ” ì½”ë“œ ì „ì²´ì—ì„œ ìƒˆ ì´ë¦„ìœ¼ë¡œ ë³€ê²½ |
| ì¤‘ê°œ í…Œì´ë¸”ì—ì„œ Reservation ê°ì²´ ì‚­ì œ ì‹œ patientì™€ doctorë„ í•¨ê»˜ ì‚­ì œë¨ | on_delete=models.CASCADE ì„¤ì • ì˜¤í•´ | .remove()ëŠ” ê´€ê³„ë§Œ ì‚­ì œ, ê°ì²´ ìì²´ëŠ” ì‚­ì œ ì•ˆ ë¨. reservation.delete()ë„ ì¤‘ê°œ í…Œì´ë¸” ë ˆì½”ë“œë§Œ ì‚­ì œ |