# 2025-11-12 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- REST APIì˜ ê°œë…ê³¼ êµ¬ì„± ìš”ì†Œ(URI, HTTP Method, JSON) í•™ìŠµ
- HTTP ìš”ì²­ ë°©ì‹(GET, POST, PUT, DELETE, PATCH)ì˜ ì—­í•  ì´í•´
- Django REST Framework(DRF) ì„¤ì¹˜ ë° í”„ë¡œì íŠ¸ ì„¤ì •
- ModelSerializerë¥¼ ì‚¬ìš©í•˜ì—¬ Django ëª¨ë¸ì„ JSONìœ¼ë¡œ ì§ë ¬í™”
- @api_view ë°ì½”ë ˆì´í„°ë¥¼ í™œìš©í•œ í•¨ìˆ˜í˜• ë·° ì‘ì„±
- Postmanì„ ì´ìš©í•œ API ì„œë²„ í…ŒìŠ¤íŠ¸ ë° ì‘ë‹µ í™•ì¸
- Article ëª¨ë¸ ê¸°ë°˜ CRUD ì „ì²´ êµ¬í˜„ (GET, POST, PUT, PATCH, DELETE)
- HTTP ì‘ë‹µ ìƒíƒœ ì½”ë“œ(200, 201, 204, 400, 404) ì´í•´ ë° ì ìš©
- partial ì¸ìë¥¼ ì‚¬ìš©í•œ ë¶€ë¶„ ìˆ˜ì •(PATCH) êµ¬í˜„
- raise_exceptionì„ í™œìš©í•œ ìœ íš¨ì„± ê²€ì‚¬ ì˜ˆì™¸ ì²˜ë¦¬

# ğŸ“š ë°°ìš´ ì 
- **APIì˜ ì—­í• **: ë³µì¡í•œ ì½”ë“œë¥¼ ì¶”ìƒí™”í•˜ì—¬ ë” ì‰¬ìš´ êµ¬ë¬¸ìœ¼ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ ê°„ í†µì‹  ê°€ëŠ¥
- **REST API ì„¤ê³„ ì›ì¹™**: "ìì› ì¤‘ì‹¬ + ë™ì‘ ëª…í™•í™” + ì¼ê´€ëœ ì‘ë‹µ í¬ë§·" ê¸°ì¤€ìœ¼ë¡œ ì„¤ê³„
- **RESTful URL ì„¤ê³„**: URLì— ë™ì‘ëª…(get, create) ë„£ì§€ ë§ê³  ìì› ì¤‘ì‹¬ìœ¼ë¡œ í‘œí˜„
- **ì‘ë‹µ ë°ì´í„° íƒ€ì…ì˜ ë³€í™”**: HTML ëŒ€ì‹  JSON ë°ì´í„°ë§Œ ì‘ë‹µí•˜ì—¬ Front-endì™€ Back-end ë¶„ë¦¬
- **Serializationì˜ ì˜ë¯¸**: Python ê°ì²´ë¥¼ ë‹¤ë¥¸ ì‹œìŠ¤í…œì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•œ í¬ë§·(JSON)ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •
- **@api_view ë°ì½”ë ˆì´í„°ì˜ í•„ìˆ˜ì„±**: DRFì—ì„œëŠ” ë°˜ë“œì‹œ ì‘ì„±í•´ì•¼ í•˜ë©°, ìƒëµ ì‹œ 500 ì—ëŸ¬ ë˜ëŠ” HTML ì‘ë‹µ ë°œìƒ
- **many ì˜µì…˜**: QuerySetì²˜ëŸ¼ ì—¬ëŸ¬ ê°ì²´ë¥¼ ì§ë ¬í™”í•  ë•Œ í•„ìˆ˜ë¡œ ì§€ì •
- **data ì†ì„±**: Serialized data ê°ì²´ì—ì„œ ì‹¤ì œ ë°ì´í„°ë¥¼ ì¶”ì¶œ
- **partial=True**: ì¼ë¶€ í•„ë“œë§Œ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©, PATCH ë©”ì„œë“œì™€ í•¨ê»˜ ì‚¬ìš©
- **PUT vs PATCH**: PUTì€ ì „ì²´ êµì²´, PATCHëŠ” ì¼ë¶€ ìˆ˜ì •
- **204 No Content**: DELETE ì„±ê³µ í›„ ë³¸ë¬¸ ì—†ì´ ì‘ë‹µí•˜ëŠ” ê²ƒì´ RESTfulí•œ ì„¤ê³„
- **raise_exception=True**: is_valid() ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ 400 ì‘ë‹µ ë°˜í™˜

# ğŸ“Œ í•µì‹¬ ê°œë…
- **API (Application Programming Interface)**: ë‘ ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì„œë¡œ í†µì‹ í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜
- **REST API**: ìì›ì„ ì •ì˜í•˜ê³  ìì›ì— ëŒ€í•œ ì£¼ì†Œë¥¼ ì§€ì •í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ê³„ ë°©ë²•ë¡ 
- **URI (Uniform Resource Identifier)**: ì¸í„°ë„·ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‹ë³„í•˜ëŠ” ë¬¸ìì—´
- **URL (Uniform Resource Locator)**: ì›¹ì—ì„œ ì£¼ì–´ì§„ ë¦¬ì†ŒìŠ¤ì˜ ì£¼ì†Œ
- **HTTP Request Methods**: ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ í–‰ìœ„ë¥¼ ì •ì˜ (GET, POST, PUT, PATCH, DELETE)
- **HTTP Response Status Codes**: ìš”ì²­ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìˆ«ì ì½”ë“œ
  - 2xx: ì„±ê³µ (200 OK, 201 Created, 204 No Content)
  - 4xx: í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ (400 Bad Request, 404 Not Found)
  - 5xx: ì„œë²„ ì˜¤ë¥˜
- **Serialization (ì§ë ¬í™”)**: ë°ì´í„° êµ¬ì¡°ë‚˜ ê°ì²´ ìƒíƒœë¥¼ ì¬êµ¬ì„±í•  ìˆ˜ ìˆëŠ” í¬ë§·ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •
- **ModelSerializer**: Django ëª¨ë¸ê³¼ ì—°ê²°ëœ Serializer í´ë˜ìŠ¤, ìë™ìœ¼ë¡œ ëª¨ë¸ í•„ë“œì— ë§ì¶° ì§ë ¬í™” ìˆ˜í–‰
- **@api_view**: DRF í•¨ìˆ˜í˜• ë·°ì—ì„œ í—ˆìš©í•  HTTP ë©”ì„œë“œë¥¼ ëª…ì‹œí•˜ëŠ” ë°ì½”ë ˆì´í„°
- **Response**: DRFì—ì„œ ì‘ë‹µ ë°ì´í„°ë¥¼ ê°ì‹¸ì„œ ë°˜í™˜í•˜ëŠ” ê°ì²´
- **many ì˜µì…˜**: QuerySet ë“± ì—¬ëŸ¬ ê°ì²´ë¥¼ ì§ë ¬í™”í•  ë•Œ ì‚¬ìš©
- **data ì†ì„±**: Serialized dataì—ì„œ ì‹¤ì œ ë°ì´í„° ì¶”ì¶œ
- **partial ì¸ì**: ì „ì²´ í•„ë“œê°€ ì•„ë‹Œ ì¼ë¶€ í•„ë“œë§Œ ì—…ë°ì´íŠ¸ í—ˆìš© (ê¸°ë³¸ê°’ False)
- **raise_exception**: is_valid() ì‹¤íŒ¨ ì‹œ ValidationError ìë™ ë°œìƒ

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ

**URL êµ¬ì¡° ë¶„ì„**
```
http://www.example.com:80/path/to/myfile.html?key1=value1&key2=value2#SomewhereInTheDocument

êµ¬ì„± ìš”ì†Œ:
- Scheme (Protocol): http://
- Domain Name: www.example.com
- Port: :80 (HTTP ê¸°ë³¸ í¬íŠ¸, ìƒëµ ê°€ëŠ¥)
- Path: /path/to/myfile.html
- Parameters: ?key1=value1&key2=value2
- Anchor: #SomewhereInTheDocument (ì„œë²„ì— ì „ì†¡ ì•ˆ ë¨)
```

**RESTful URL ì„¤ê³„ ì›ì¹™**
```python
# âŒ ì˜ëª»ëœ ì„¤ê³„ (ë™ì‘ëª… í¬í•¨)
/getArticles/
/createArticle/
/deleteArticle/1/
/updateArticle/1/

# âœ… ì˜¬ë°”ë¥¸ ì„¤ê³„ (ìì› ì¤‘ì‹¬)
GET     /articles/          # ì „ì²´ ê²Œì‹œê¸€ ì¡°íšŒ
POST    /articles/          # ê²Œì‹œê¸€ ìƒì„±
GET     /articles/1/        # 1ë²ˆ ê²Œì‹œê¸€ ì¡°íšŒ
PUT     /articles/1/        # 1ë²ˆ ê²Œì‹œê¸€ ì „ì²´ ìˆ˜ì •
PATCH   /articles/1/        # 1ë²ˆ ê²Œì‹œê¸€ ë¶€ë¶„ ìˆ˜ì •
DELETE  /articles/1/        # 1ë²ˆ ê²Œì‹œê¸€ ì‚­ì œ
```

**í”„ë¡œì íŠ¸ ì‚¬ì „ ì¤€ë¹„**
```bash
# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
$ python -m venv venv
$ source venv/Scripts/activate  # Windows: venv\Scripts\activate

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
$ pip install -r requirements.txt

# Django REST framework í¬í•¨ëœ requirements.txt ì˜ˆì‹œ:
# Django==4.2
# djangorestframework==3.14.0

# ë§ˆì´ê·¸ë ˆì´ì…˜
$ python manage.py migrate

# Fixtures ë°ì´í„° ë¡œë“œ
$ python manage.py loaddata articles.json

# ì„œë²„ ì‹¤í–‰
$ python manage.py runserver
```

**Article ëª¨ë¸**
```python
# articles/models.py
from django.db import models

class Article(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.title
```

**Serializer ì •ì˜**
```python
# articles/serializers.py
from rest_framework import serializers
from .models import Article

# ê²Œì‹œê¸€ ëª©ë¡ìš© Serializer (ì¼ë¶€ í•„ë“œë§Œ)
class ArticleListSerializer(serializers.ModelSerializer):
    class Meta:
        model = Article
        fields = ('id', 'title', 'content',)

# ê²Œì‹œê¸€ ìƒì„¸/ìƒì„±/ìˆ˜ì •ìš© Serializer (ì „ì²´ í•„ë“œ)
class ArticleSerializer(serializers.ModelSerializer):
    class Meta:
        model = Article
        fields = '__all__'
        # ë˜ëŠ” íŠ¹ì • í•„ë“œë§Œ ëª…ì‹œ
        # fields = ('id', 'title', 'content', 'created_at', 'updated_at',)
```

**GET - ì „ì²´ ê²Œì‹œê¸€ ì¡°íšŒ (List)**
```python
# articles/urls.py
from django.urls import path
from . import views

app_name = 'articles'
urlpatterns = [
    path('articles/', views.article_list),
    path('articles/<int:article_pk>/', views.article_detail),
]
```
```python
# articles/views.py
from rest_framework.response import Response
from rest_framework.decorators import api_view
from rest_framework import status

from .models import Article
from .serializers import ArticleListSerializer, ArticleSerializer

@api_view(['GET'])  # í—ˆìš©í•  HTTP ë©”ì„œë“œ ëª…ì‹œ (í•„ìˆ˜!)
def article_list(request):
    # 1. ëª¨ë“  ê²Œì‹œê¸€ ì¡°íšŒ
    articles = Article.objects.all()
    
    # 2. Serializerë¡œ ì§ë ¬í™” (many=True: ì—¬ëŸ¬ ê°ì²´)
    serializer = ArticleListSerializer(articles, many=True)
    
    # 3. JSON ì‘ë‹µ ë°˜í™˜
    return Response(serializer.data)

# Postman í…ŒìŠ¤íŠ¸:
# GET http://127.0.0.1:8000/api/v1/articles/
# ì‘ë‹µ: [{"id": 1, "title": "...", "content": "..."}, ...]
```

**GET - ë‹¨ì¼ ê²Œì‹œê¸€ ì¡°íšŒ (Detail)**
```python
# articles/views.py
@api_view(['GET'])
def article_detail(request, article_pk):
    # 1. íŠ¹ì • ê²Œì‹œê¸€ ì¡°íšŒ
    article = Article.objects.get(pk=article_pk)
    
    # 2. Serializerë¡œ ì§ë ¬í™” (ë‹¨ì¼ ê°ì²´, many ì˜µì…˜ ë¶ˆí•„ìš”)
    serializer = ArticleSerializer(article)
    
    # 3. JSON ì‘ë‹µ ë°˜í™˜
    return Response(serializer.data)

# Postman í…ŒìŠ¤íŠ¸:
# GET http://127.0.0.1:8000/api/v1/articles/1/
# ì‘ë‹µ: {"id": 1, "title": "...", "content": "...", "created_at": "...", ...}
```

**POST - ê²Œì‹œê¸€ ìƒì„±**
```python
# articles/views.py
@api_view(['GET', 'POST'])  # ì—¬ëŸ¬ ë©”ì„œë“œ í—ˆìš© ê°€ëŠ¥
def article_list(request):
    if request.method == 'GET':
        # ì¡°íšŒ ë¡œì§
        articles = Article.objects.all()
        serializer = ArticleListSerializer(articles, many=True)
        return Response(serializer.data)
    
    elif request.method == 'POST':
        # 1. ìš”ì²­ ë°ì´í„°ë¡œ Serializer ìƒì„±
        serializer = ArticleSerializer(data=request.data)
        
        # 2. ìœ íš¨ì„± ê²€ì‚¬
        if serializer.is_valid():
            # 3. ì €ì¥
            serializer.save()
            # 4. ìƒì„±ëœ ë°ì´í„°ì™€ 201 Created ì‘ë‹µ
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        
        # ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ 400 Bad Request
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

# Postman í…ŒìŠ¤íŠ¸:
# POST http://127.0.0.1:8000/api/v1/articles/
# Body > form-data:
#   title: "New Article"
#   content: "This is content"
# ì‘ë‹µ: {"id": 21, "title": "New Article", ...} (201 Created)
```

**POST - raise_exception ì‚¬ìš©**
```python
# articles/views.py
@api_view(['GET', 'POST'])
def article_list(request):
    if request.method == 'GET':
        articles = Article.objects.all()
        serializer = ArticleListSerializer(articles, many=True)
        return Response(serializer.data)
    
    elif request.method == 'POST':
        serializer = ArticleSerializer(data=request.data)
        
        # raise_exception=True: ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ 400 ì‘ë‹µ
        if serializer.is_valid(raise_exception=True):
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        
        # ì•„ë˜ ì¤„ì€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ (raise_exceptionì´ ì²˜ë¦¬)
        # return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

**DELETE - ê²Œì‹œê¸€ ì‚­ì œ (ë³¸ë¬¸ ì—†ìŒ)**
```python
# articles/views.py
@api_view(['GET', 'DELETE'])
def article_detail(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    
    if request.method == 'GET':
        serializer = ArticleSerializer(article)
        return Response(serializer.data)
    
    elif request.method == 'DELETE':
        # 1. ì‚­ì œ ì‹¤í–‰
        article.delete()
        
        # 2. 204 No Content ì‘ë‹µ (ë³¸ë¬¸ ì—†ìŒ, ìƒíƒœ ì½”ë“œë§Œ)
        return Response(status=status.HTTP_204_NO_CONTENT)

# Postman í…ŒìŠ¤íŠ¸:
# DELETE http://127.0.0.1:8000/api/v1/articles/1/
# ì‘ë‹µ: (ë¹ˆ ë³¸ë¬¸, 204 No Content)
```

**DELETE - ì‚­ì œ ë©”ì‹œì§€ í¬í•¨ ì‘ë‹µ**
```python
# articles/views.py
@api_view(['GET', 'DELETE'])
def article_detail(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    
    if request.method == 'GET':
        serializer = ArticleSerializer(article)
        return Response(serializer.data)
    
    elif request.method == 'DELETE':
        # 1. ì‚­ì œ ì „ì— ì •ë³´ ì €ì¥ (ì‚­ì œ í›„ì—ëŠ” ì ‘ê·¼ ë¶ˆê°€)
        pk = article.pk
        title = article.title
        
        # 2. ì‚­ì œ ì‹¤í–‰
        article.delete()
        
        # 3. ì‚­ì œëœ ì •ë³´ì™€ í•¨ê»˜ 200 OK ì‘ë‹µ
        data = {
            'message': f'{pk}ë²ˆ ê²Œì‹œê¸€ "{title}"ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'
        }
        return Response(data, status=status.HTTP_200_OK)

# Postman í…ŒìŠ¤íŠ¸:
# DELETE http://127.0.0.1:8000/api/v1/articles/1/
# ì‘ë‹µ: {"message": "1ë²ˆ ê²Œì‹œê¸€ "First Article"ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."} (200 OK)
```

**PUT - ì „ì²´ ìˆ˜ì •**
```python
# articles/views.py
@api_view(['GET', 'DELETE', 'PUT'])
def article_detail(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    
    if request.method == 'GET':
        serializer = ArticleSerializer(article)
        return Response(serializer.data)
    
    elif request.method == 'DELETE':
        article.delete()
        return Response(status=status.HTTP_204_NO_CONTENT)
    
    elif request.method == 'PUT':
        # 1. ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ì™€ ìƒˆ ë°ì´í„°ë¥¼ í•¨ê»˜ ì „ë‹¬
        serializer = ArticleSerializer(article, data=request.data)
        # serializer = ArticleSerializer(instance=article, data=request.data, partial=False)
        
        # 2. ìœ íš¨ì„± ê²€ì‚¬ (ëª¨ë“  í•„ë“œ í•„ìš”)
        if serializer.is_valid():
            # 3. ì €ì¥
            serializer.save()
            # 4. ìˆ˜ì •ëœ ë°ì´í„° ë°˜í™˜
            return Response(serializer.data)
        
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

# Postman í…ŒìŠ¤íŠ¸:
# PUT http://127.0.0.1:8000/api/v1/articles/1/
# Body > form-data:
#   title: "Updated Title"
#   content: "Updated Content"
# âš ï¸ ëª¨ë“  í•„ìˆ˜ í•„ë“œ ì „ì†¡ í•„ìš” (partial=False ê¸°ë³¸ê°’)
# ì‘ë‹µ: {"id": 1, "title": "Updated Title", ...} (200 OK)
```

**PATCH - ë¶€ë¶„ ìˆ˜ì •**
```python
# articles/views.py
@api_view(['GET', 'DELETE', 'PATCH'])
def article_detail(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    
    if request.method == 'GET':
        serializer = ArticleSerializer(article)
        return Response(serializer.data)
    
    elif request.method == 'DELETE':
        article.delete()
        return Response(status=status.HTTP_204_NO_CONTENT)
    
    elif request.method == 'PATCH':
        # partial=True: ì¼ë¶€ í•„ë“œë§Œ ì „ì†¡ ê°€ëŠ¥
        serializer = ArticleSerializer(article, data=request.data, partial=True)
        
        if serializer.is_valid(raise_exception=True):
            serializer.save()
            return Response(serializer.data)
        
        # raise_exception=Trueë¡œ ì•„ë˜ ì¤„ì€ ì‹¤í–‰ ì•ˆ ë¨
        # return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

# Postman í…ŒìŠ¤íŠ¸:
# PATCH http://127.0.0.1:8000/api/v1/articles/1/
# Body > form-data:
#   title: "Only Title Changed"
# âœ… titleë§Œ ì „ì†¡í•´ë„ ë¨ (partial=True)
# ì‘ë‹µ: {"id": 1, "title": "Only Title Changed", "content": "ê¸°ì¡´ ë‚´ìš©", ...}
```

**PUT vs PATCH ë¹„êµ**
```python
# PUT - ì „ì²´ êµì²´
@api_view(['PUT'])
def article_update_full(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    # partial=False (ê¸°ë³¸ê°’): ëª¨ë“  í•„ë“œ í•„ìš”
    serializer = ArticleSerializer(article, data=request.data)
    if serializer.is_valid(raise_exception=True):
        serializer.save()
        return Response(serializer.data)

# PATCH - ë¶€ë¶„ ìˆ˜ì •
@api_view(['PATCH'])
def article_update_partial(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    # partial=True: ì¼ë¶€ í•„ë“œë§Œ ì „ì†¡ ê°€ëŠ¥
    serializer = ArticleSerializer(article, data=request.data, partial=True)
    if serializer.is_valid(raise_exception=True):
        serializer.save()
        return Response(serializer.data)
```

**HTTP ì‘ë‹µ ìƒíƒœ ì½”ë“œ ì‚¬ìš© ì˜ˆì‹œ**
```python
# articles/views.py
from rest_framework import status

# 200 OK - ì„±ê³µ (ê¸°ë³¸ê°’)
return Response(serializer.data)
return Response(serializer.data, status=status.HTTP_200_OK)

# 201 Created - ìƒì„± ì„±ê³µ
return Response(serializer.data, status=status.HTTP_201_CREATED)

# 204 No Content - ì„±ê³µ, ë³¸ë¬¸ ì—†ìŒ
return Response(status=status.HTTP_204_NO_CONTENT)

# 400 Bad Request - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì˜¤ë¥˜
return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

# 404 Not Found - ë¦¬ì†ŒìŠ¤ ì—†ìŒ
from django.shortcuts import get_object_or_404
article = get_object_or_404(Article, pk=article_pk)
```

**ì™„ì „í•œ CRUD View í•¨ìˆ˜ ì˜ˆì‹œ**
```python
# articles/views.py
from rest_framework.response import Response
from rest_framework.decorators import api_view
from rest_framework import status
from django.shortcuts import get_object_or_404

from .models import Article
from .serializers import ArticleListSerializer, ArticleSerializer

# ëª©ë¡ ì¡°íšŒ & ìƒì„±
@api_view(['GET', 'POST'])
def article_list(request):
    if request.method == 'GET':
        articles = Article.objects.all()
        serializer = ArticleListSerializer(articles, many=True)
        return Response(serializer.data)
    
    elif request.method == 'POST':
        serializer = ArticleSerializer(data=request.data)
        if serializer.is_valid(raise_exception=True):
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)

# ìƒì„¸ ì¡°íšŒ & ìˆ˜ì • & ì‚­ì œ
@api_view(['GET', 'PUT', 'PATCH', 'DELETE'])
def article_detail(request, article_pk):
    article = get_object_or_404(Article, pk=article_pk)
    
    if request.method == 'GET':
        serializer = ArticleSerializer(article)
        return Response(serializer.data)
    
    elif request.method == 'PUT':
        serializer = ArticleSerializer(article, data=request.data)
        if serializer.is_valid(raise_exception=True):
            serializer.save()
            return Response(serializer.data)
    
    elif request.method == 'PATCH':
        serializer = ArticleSerializer(article, data=request.data, partial=True)
        if serializer.is_valid(raise_exception=True):
            serializer.save()
            return Response(serializer.data)
    
    elif request.method == 'DELETE':
        pk = article.pk
        title = article.title
        article.delete()
        data = {'message': f'{pk}ë²ˆ ê²Œì‹œê¸€ "{title}"ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'}
        return Response(data, status=status.HTTP_200_OK)
```

**Pythonìœ¼ë¡œ API ìš”ì²­ í…ŒìŠ¤íŠ¸**
```python
# python-request-sample.py
import requests
from pprint import pprint

# GET ìš”ì²­
response = requests.get('http://127.0.0.1:8000/api/v1/articles/')

# JSONì„ Python íƒ€ì…ìœ¼ë¡œ ë³€í™˜
result = response.json()

print(type(result))  # <class 'list'>
pprint(result)
pprint(result[0])
pprint(result[0].get('title'))

# ì‹¤í–‰ ë°©ë²•:
# $ python python-request-sample.py
```

**Postman í…ŒìŠ¤íŠ¸ ë°©ë²•**
```
1. Postman ì„¤ì¹˜: https://www.postman.com/downloads/

2. ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±

3. ìš”ì²­ êµ¬ì„±:
   - Method ì„ íƒ: GET, POST, PUT, PATCH, DELETE
   - URL ì…ë ¥: http://127.0.0.1:8000/api/v1/articles/
   
4. POST/PUT/PATCH ìš”ì²­ ì‹œ Body ì„¤ì •:
   - Body íƒ­ ì„ íƒ
   - form-data ì„ íƒ
   - Key-Value ìŒ ì…ë ¥:
     title: "Test Title"
     content: "Test Content"

5. Send ë²„íŠ¼ í´ë¦­í•˜ì—¬ ìš”ì²­ ì „ì†¡

6. ì‘ë‹µ í™•ì¸:
   - Status: 200 OK, 201 Created, 204 No Content ë“±
   - Body: JSON í˜•ì‹ ì‘ë‹µ ë°ì´í„°
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| @api_view ë°ì½”ë ˆì´í„° ì—†ì´ ë·° í•¨ìˆ˜ ì‘ì„± ì‹œ 500 ì—ëŸ¬ ë˜ëŠ” HTML ì‘ë‹µ ë°˜í™˜ | DRFëŠ” @api_view ì—†ì´ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ ì¼ë°˜ Django ë·°ë¡œ ì¸ì‹ | ëª¨ë“  DRF ë·° í•¨ìˆ˜ì— `@api_view(['GET', 'POST', ...])` ë°ì½”ë ˆì´í„° í•„ìˆ˜ ì‘ì„± |
| QuerySet ì§ë ¬í™” ì‹œ "instance must be a queryset or list" ì—ëŸ¬ | many=True ì˜µì…˜ì„ ì§€ì •í•˜ì§€ ì•ŠìŒ | `ArticleSerializer(articles, many=True)` í˜•ì‹ìœ¼ë¡œ many ì˜µì…˜ ì¶”ê°€ |
| POST ìš”ì²­ ì‹œ "This field is required" ì—ëŸ¬ ë°œìƒ | í•„ìˆ˜ í•„ë“œê°€ request.dataì— í¬í•¨ë˜ì§€ ì•ŠìŒ | Postmanì—ì„œ form-dataì— ëª¨ë“  í•„ìˆ˜ í•„ë“œ ì…ë ¥ í™•ì¸ |
| PUT ìš”ì²­ ì‹œ ì¼ë¶€ í•„ë“œë§Œ ì „ì†¡í–ˆëŠ”ë° ì—ëŸ¬ ë°œìƒ | PUTì€ ì „ì²´ í•„ë“œ í•„ìš” (partial=False ê¸°ë³¸ê°’) | PATCH ë©”ì„œë“œ ì‚¬ìš©í•˜ê±°ë‚˜ `partial=True` ì˜µì…˜ ì¶”ê°€ |
| PATCH ìš”ì²­ì´ 400 ì—ëŸ¬ ë°˜í™˜ | partial=True ì˜µì…˜ì„ ì„¤ì •í•˜ì§€ ì•ŠìŒ | `ArticleSerializer(article, data=request.data, partial=True)` í˜•ì‹ìœ¼ë¡œ ì‘ì„± |
| DELETE í›„ ë³¸ë¬¸ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë ¤ëŠ”ë° 204 ìƒíƒœ ì½”ë“œ ì‚¬ìš© | 204 No ContentëŠ” ë³¸ë¬¸ ì—†ìŒì„ ì˜ë¯¸ | ë°ì´í„° ë°˜í™˜ ì‹œ 200 OK ì‚¬ìš©, ë³¸ë¬¸ ì—†ìœ¼ë©´ 204 ì‚¬ìš© |
| serializer.data ì ‘ê·¼ ì‹œ ë¹ˆ ë”•ì…”ë„ˆë¦¬ ë°˜í™˜ | is_valid() í˜¸ì¶œí•˜ì§€ ì•Šê³  save() ì‹¤í–‰ | save() ì „ì— ë°˜ë“œì‹œ `if serializer.is_valid():` ì²´í¬ |
| 400 ì—ëŸ¬ ë°œìƒ ì‹œ ì–´ë–¤ í•„ë“œê°€ ë¬¸ì œì¸ì§€ ëª¨ë¦„ | serializer.errorsë¥¼ í™•ì¸í•˜ì§€ ì•ŠìŒ | `return Response(serializer.errors, status=400)` ë˜ëŠ” `raise_exception=True` ì‚¬ìš© |
| Response() í˜¸ì¶œ ì‹œ TypeError ë°œìƒ | ì²« ë²ˆì§¸ ì¸ì ì—†ì´ statusë§Œ ì „ë‹¬ | `Response(status=...)` í˜•ì‹ìœ¼ë¡œ í‚¤ì›Œë“œ ì¸ìë¡œ ì „ë‹¬ |