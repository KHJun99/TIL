# 2025-11-04 TIL

# ✅ 오늘 한 일
- SQL의 DDL, DML, DCL 문법 학습
- CREATE TABLE로 테이블 생성 및 제약조건 설정
- INSERT, UPDATE, DELETE로 데이터 조작 실습
- ALTER TABLE로 테이블 구조 수정 방법 학습
- DROP TABLE로 테이블 삭제 실습
- INNER JOIN과 LEFT JOIN의 차이점 이해 및 활용
- 외래 키(Foreign Key)를 이용한 테이블 간 관계 설정

# 📚 배운 점
- **SQL Statements 유형**: DDL(정의), DQL(검색), DML(조작), DCL(제어)로 구분
- **AUTOINCREMENT의 동작**: 삭제된 값은 재사용되지 않으며 항상 이전 최대값보다 큰 값 할당
- **WHERE 절의 중요성**: UPDATE와 DELETE에서 WHERE 절을 생략하면 모든 레코드가 영향을 받음
- **JOIN의 필요성**: 테이블 분리로 데이터 관리는 용이하지만, 출력 시 여러 테이블을 결합해야 함
- **INNER JOIN vs LEFT JOIN**: INNER는 양쪽 모두 있는 데이터만, LEFT는 왼쪽 기준 모든 데이터 조회
- **타입 선호도(Type Affinity)**: SQLite는 데이터 타입을 유연하게 추론하여 처리
- **SQLite의 날짜 처리**: 별도 DATE 타입 없이 TEXT, REAL, INTEGER로 저장하고 함수로 처리

# 📌 핵심 개념
- **PRIMARY KEY 제약**: SQLite에서는 INTEGER 타입에만 적용 가능 (INT, BIGINT 불가)
- **NOT NULL 제약**: NULL 값 허용하지 않음, 대부분의 필드에 권장
- **FOREIGN KEY**: 다른 테이블의 PRIMARY KEY를 참조하여 관계 형성
- **AUTOINCREMENT**: INTEGER PRIMARY KEY와 함께 사용하여 자동 증가
- **PRAGMA table_info()**: 테이블 구조 확인 명령어
- **DATE() 함수**: 현재 날짜 자동 입력
- **LEFT JOIN + IS NULL**: 관계가 없는 데이터를 찾는 패턴
- **테이블 분리의 장점**: 중복 감소, 수정 용이, 데이터 무결성 유지

# 💡 예시 코드

**CREATE TABLE - 테이블 생성**
```sql
-- 기본 테이블 생성
CREATE TABLE examples (
    ExamId INTEGER PRIMARY KEY AUTOINCREMENT,
    LastName VARCHAR(50) NOT NULL,
    FirstName VARCHAR(50) NOT NULL
);

-- 테이블 구조 확인
PRAGMA table_info('examples');

-- 외래 키가 포함된 테이블 생성
CREATE TABLE articles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(50) NOT NULL,
    content VARCHAR(100) NOT NULL,
    userId INTEGER NOT NULL,
    FOREIGN KEY (userId) REFERENCES users(id)
);
```

**ALTER TABLE - 테이블 구조 수정**
```sql
-- 필드 추가
ALTER TABLE examples
ADD COLUMN Country VARCHAR(100) NOT NULL DEFAULT 'default value';

ALTER TABLE examples
ADD COLUMN Age INTEGER NOT NULL DEFAULT 0;

-- 필드 이름 변경
ALTER TABLE examples
RENAME COLUMN Address TO PostCode;

-- 필드 삭제
ALTER TABLE examples
DROP COLUMN PostCode;

-- 테이블 이름 변경
ALTER TABLE examples
RENAME TO new_examples;
```

**DROP TABLE - 테이블 삭제**
```sql
-- 테이블 삭제 (복구 불가능!)
DROP TABLE new_examples;
```

**INSERT - 데이터 삽입**
```sql
-- 단일 데이터 삽입
INSERT INTO articles (title, content, createdAt)
VALUES ('hello', 'world', '2000-01-01');

-- 여러 데이터 동시 삽입
INSERT INTO articles (title, content, createdAt)
VALUES
    ('title1', 'content1', '1900-01-01'),
    ('title2', 'content2', '1800-01-01'),
    ('title3', 'content3', '1700-01-01');

-- DATE 함수 활용 (현재 날짜 자동 입력)
INSERT INTO articles (title, content, createdAt)
VALUES ('mytitle', 'mycontent', DATE());

-- DATETIME 함수 활용 (현재 날짜+시간)
INSERT INTO articles (title, content, createdAt)
VALUES ('제목', '내용', DATETIME());
```

**UPDATE - 데이터 수정**
```sql
-- 단일 필드 수정
UPDATE articles
SET title = 'update Title'
WHERE id = 1;

-- 여러 필드 동시 수정
UPDATE articles
SET
    title = 'update Title',
    content = 'update Content'
WHERE id = 2;

-- ⚠️ WHERE 절이 없으면 모든 레코드 수정됨!
```

**DELETE - 데이터 삭제**
```sql
-- 특정 레코드 삭제
DELETE FROM articles
WHERE id = 1;

-- 조건에 맞는 여러 레코드 삭제
-- 작성일이 오래된 순으로 2개 삭제
DELETE FROM articles
WHERE id IN (
    SELECT id FROM articles
    ORDER BY createdAt
    LIMIT 2
);

-- ⚠️ WHERE 절이 없으면 모든 레코드 삭제됨!
```

**사전 준비 - 실습용 테이블 생성**
```sql
-- 기존 테이블 삭제
DROP TABLE articles;
DROP TABLE users;

-- users 테이블 생성
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(50) NOT NULL
);

-- articles 테이블 생성 (외래 키 포함)
CREATE TABLE articles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(50) NOT NULL,
    content VARCHAR(100) NOT NULL,
    userId INTEGER NOT NULL,
    FOREIGN KEY (userId) REFERENCES users(id)
);

-- 데이터 삽입
INSERT INTO users (name)
VALUES ('하석주'), ('송윤미'), ('유하선');

INSERT INTO articles (title, content, userId)
VALUES
    ('제목1', '내용1', 1),
    ('제목2', '내용2', 2),
    ('제목3', '내용3', 1),
    ('제목4', '내용4', 4),  -- userId=4는 users에 없음
    ('제목5', '내용5', 1);
```

**INNER JOIN - 양쪽 모두 있는 데이터만 조회**
```sql
-- 작성자가 있는 모든 게시글 조회
SELECT *
FROM articles
INNER JOIN users
    ON users.id = articles.userId;

-- 결과: userId=4인 '제목4'는 제외됨 (users에 해당 사용자 없음)

-- 1번 회원(하석주)이 작성한 게시글의 제목과 작성자명
SELECT articles.title, users.name
FROM articles
INNER JOIN users
    ON users.id = articles.userId
WHERE users.id = 1;
```

**LEFT JOIN - 왼쪽 기준 모든 데이터 조회**
```sql
-- 모든 게시글을 작성자 정보와 함께 조회
SELECT *
FROM articles
LEFT JOIN users
    ON users.id = articles.userId;

-- 결과: userId=4인 '제목4'도 조회되며, 
-- 사용자 정보는 NULL로 표시

-- 게시글을 작성한 이력이 없는 회원 조회
SELECT users.name
FROM users
LEFT JOIN articles
    ON articles.userId = users.id
WHERE articles.userId IS NULL;

-- 결과: 유하선 (게시글 작성 이력 없음)
```

**JOIN 비교 예시**
```sql
-- INNER JOIN: 관계가 있는 데이터만
SELECT u.name, a.title
FROM users u
INNER JOIN articles a
    ON u.id = a.userId;

-- LEFT JOIN: 모든 사용자 + 게시글 정보
SELECT u.name, a.title
FROM users u
LEFT JOIN articles a
    ON u.id = a.userId;

-- LEFT JOIN으로 "없는 것" 찾기
SELECT u.name
FROM users u
LEFT JOIN articles a
    ON u.id = a.userId
WHERE a.id IS NULL;
```

**실습 문제 예시**
```sql
-- students 테이블 생성
CREATE TABLE students (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(50) NOT NULL,
    age INTEGER NOT NULL,
    major VARCHAR(50) NOT NULL
);

-- 데이터 삽입
INSERT INTO students (name, age, major)
VALUES
    ('김철수', 21, '컴퓨터공학'),
    ('이영희', 22, '경영학'),
    ('박민수', 20, '전자공학');

-- 모든 학생의 이름과 전공 조회
SELECT name, major
FROM students;

-- grade 필드 추가
ALTER TABLE students
ADD COLUMN grade INTEGER NOT NULL DEFAULT 0;

-- 특정 학생의 학점 수정
UPDATE students
SET grade = 95
WHERE name = '김철수';

-- courses 테이블 생성
CREATE TABLE courses (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(100) NOT NULL,
    credits INTEGER NOT NULL
);

-- enrollments 테이블 생성 (외래 키)
CREATE TABLE enrollments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    studentId INTEGER NOT NULL,
    courseId INTEGER NOT NULL,
    FOREIGN KEY (studentId) REFERENCES students(id),
    FOREIGN KEY (courseId) REFERENCES courses(id)
);

-- INNER JOIN으로 학생의 수강 과목 조회
SELECT s.name, c.title
FROM students s
INNER JOIN enrollments e ON s.id = e.studentId
INNER JOIN courses c ON e.courseId = c.id;

-- LEFT JOIN으로 수강 신청 안 한 학생 찾기
SELECT s.name
FROM students s
LEFT JOIN enrollments e ON s.id = e.studentId
WHERE e.id IS NULL;
```

# 🛠️ 이슈 & 해결
| 🐞 문제 상황 | 🔍 원인 | 💡 해결 방법 |
|--------------|--------|--------------|
| PRIMARY KEY를 INT 타입으로 지정했을 때 AUTOINCREMENT 작동 안 함 | SQLite는 INTEGER 타입에만 PRIMARY KEY + AUTOINCREMENT 적용 가능 | `INTEGER PRIMARY KEY AUTOINCREMENT` 형식으로 정확히 작성 |
| UPDATE/DELETE 실행 시 모든 레코드가 변경됨 | WHERE 절을 작성하지 않음 | WHERE 절을 반드시 포함하여 조건 명시 |
| ALTER TABLE로 여러 필드를 한 번에 추가 시도 시 에러 | SQLite는 단일 문으로 여러 필드 추가 불가 | ALTER TABLE 문을 여러 번 실행하여 필드를 하나씩 추가 |
| INNER JOIN 사용 시 일부 데이터가 조회되지 않음 | 양쪽 테이블 모두에 매칭되는 데이터만 조회됨 | 모든 데이터를 보려면 LEFT JOIN 사용 |
| LEFT JOIN 결과에서 중복된 컬럼명으로 혼란 | 두 테이블에 같은 이름의 컬럼 존재 | 테이블 별칭 사용 또는 `테이블명.컬럼명` 형식으로 명확히 지정 |
| 날짜 데이터를 DATE 타입으로 지정 시도 | SQLite에는 별도 DATE 타입이 없음 | TEXT, REAL, INTEGER 중 하나로 저장하고 DATE(), DATETIME() 함수 활용 |