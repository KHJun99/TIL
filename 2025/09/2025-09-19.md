# 2025-09-19 TIL

# ✅ 오늘 한 일
- **Django Template System/Language(DTL)** 핵심 문법(변수·필터·태그·주석) 정리
- **템플릿 상속(base.html ↔ child.html)**과 폴더 구조 정리
- **HTML form → 요청/응답(GET/POST)**, request 객체 접근 실습
- **URLs**: URL dispatcher, Variable Routing, `include()`, Naming( `name=` ), **네임스페이스(`app_name`)**까지 구성

# 📚 배운 점
- **DTL**은 “표현”을 위한 언어로, 파이썬이 아니라 템플릿 엔진에서 처리된다.
- **템플릿 상속**으로 공통 레이아웃을 공유하고 블록만 교체하여 유지보수성↑.
- **form 핵심**: `action`(목적지), `method`(전송 방식), `input name`(key) — 서버는 `request.GET/POST['name']`로 접근.
- **URL 설계**: 앱별 `urls.py`로 분리 + `include()` 사용, `name`과 `app_name`으로 **의미 기반 링크** 관리.
- **Trailing slash**: Django는 기본적으로 URL 끝에 `/`를 강제(`APPEND_SLASH=True`) — SEO/중복 URL 예방.

# 📌 핵심 개념
- **DTL Syntax**
  - Variable: `{{ user.username }}`
  - Filters: `{{ text|truncatewords:10 }}`, `{{ date|date:"Y-m-d" }}` (체이닝 가능)
  - Tags: `{% if %}/{% for %}/{% url %}/{% extends %}/{% block %}`
  - Comments: `{# inline #}`, `{% comment %} ... {% endcomment %}`
- **템플릿 상속**
  - 상위 `base.html`에 공통 레이아웃과 `{% block content %}` 정의 → 자식이 `{% extends "base.html" %}` 후 블록만 재정의
- **Variable Routing**
  - `path("articles/<int:num>/", views.detail, name="detail")` → `views.detail(request, num)`
- **URL 네임스페이스**
  - 앱 `urls.py`에 `app_name = "articles"` 선언 → 템플릿에서 `{% url 'articles:detail' num %}`

# 💡 예시 코드

```html
<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>{% block title %}My Site{% endblock title %}</title>
</head>
<body>
  <header>
    <a href="{% url 'articles:index' %}">Home</a>
    <nav>{% block nav %}{% endblock nav %}</nav>
  </header>
  <main>
    {% block content %}{% endblock content %}
  </main>
  <footer>© {{ now|date:"Y" }}</footer>
</body>
</html>
```

```html
<!-- templates/articles/index.html -->
{% extends "base.html" %}
{% block title %}Articles{% endblock title %}
{% block content %}
  <h1>Articles</h1>
  <p>{{ msg|default:"Hello Django!" }}</p>
  <ul>
    {% for art in articles %}
      <li>
        <a href="{% url 'articles:detail' art.id %}">{{ art.title|truncatewords:5 }}</a>
      </li>
    {% empty %}
      <li>No articles</li>
    {% endfor %}
  </ul>
{% endblock content %}
```

```python
# articles/views.py
from django.shortcuts import render
from django.http import HttpResponse

def index(request):
    ctx = {
        "msg": "DTL & URLs 연습",
        "articles": [{"id":1,"title":"장고 템플릿 언어 배우기"},
                     {"id":2,"title":"URL 네임스페이스와 include로 라우팅 정리"}],
    }
    return render(request, "articles/index.html", ctx)

def detail(request, num):
    return HttpResponse(f"Detail page: article #{num}")

# throw → catch (GET 예시)
def throw(request):
    return render(request, "articles/throw.html")

def catch(request):
    message = request.GET.get("message", "")
    return render(request, "articles/catch.html", {"message": message})
```

```html
<!-- templates/articles/throw.html -->
{% extends "base.html" %}
{% block content %}
  <h2>Throw</h2>
  <form action="{% url 'articles:catch' %}" method="get">
    <input type="text" name="message" placeholder="메시지 입력">
    <button type="submit">보내기</button>
  </form>
{% endblock content %}
```

```html
<!-- templates/articles/catch.html -->
{% extends "base.html" %}
{% block content %}
  <h2>Catch</h2>
  <p>서버에서 받은 메시지: <strong>{{ message|upper }}</strong></p>
{% endblock content %}
```

```python
# firstpjt/urls.py (프로젝트 루트)
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('articles/', include('articles.urls')),  # 앱 URL 위임
]
```

```python
# articles/urls.py (앱 라우팅 + 네임스페이스)
from django.urls import path
from . import views

app_name = "articles"
urlpatterns = [
    path("", views.index, name="index"),
    path("throw/", views.throw, name="throw"),
    path("catch/", views.catch, name="catch"),
    path("<int:num>/", views.detail, name="detail"),  # Variable Routing
]
```

```python
# settings.py (추가 템플릿 경로 사용 시)
from pathlib import Path
BASE_DIR = Path(__file__).resolve().parent.parent

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [BASE_DIR / "templates"],  # 전역 templates 디렉터리
        "APP_DIRS": True,
        "OPTIONS": {"context_processors": [
            "django.template.context_processors.debug",
            "django.template.context_processors.request",
            "django.contrib.auth.context_processors.auth",
            "django.contrib.messages.context_processors.messages",
        ]},
    },
]

# trailing slash 정책(기본 True)
APPEND_SLASH = True
```

```html
<!-- 전역 templates/base.html 을 사용할 때 extends 경로 -->
{% extends "base.html" %}
```

# 🛠️ 이슈 & 해결
| 🐞 문제 상황 | 🔍 원인 | 💡 해결 방법 |
|--------------|--------|--------------|
| 템플릿 경로 오류(TemplateDoesNotExist) | 폴더 구조/파일명 오타 | `app/templates/app/...` 또는 전역 `templates/` + `TEMPLATES['DIRS']` 설정 확인 |
| URL 변경 시 링크 끊김 | 하드코딩된 경로(`/articles/index/`) | 템플릿의 `{% url 'app:name' %}` 사용, 뷰/리다이렉트도 `reverse()` 활용 |
| Variable Routing 타입 에러 | `<int:...>`에 문자열 전달 | 컨버터 타입 점검, 필요 시 `<str:...>` 사용 |
| catch에서 값이 빈문자 | `input name` 불일치 | `name`과 서버측 키 동일하게, `GET.get("key", default)` |
| 슬래시 404/301 반복 | trailing slash 정책 미이해 | `APPEND_SLASH` 확인, URL 패턴 끝에 `/` 일관되게 작성 |

# 🎯 내일 할 일
- 📚 템플릿 상속 + `block.super` 응용, 템플릿 필터/태그(커스텀 태그 포함) 더 연습
- 💻 POST 폼 + CSRF + 폼 유효성 검증으로 간단 입력 처리 구현
- 🔍 `include()` + `namespace`로 다중 앱 라우팅 구조 리팩터링 및 URL 리버스 테스트
