# 2025-09-24 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- **ORM ê°œë…**ê³¼ Djangoì—ì„œì˜ ì—­í• (íŒŒì´ì¬ ê°ì²´ â†” DB ë ˆì½”ë“œ ë§¤í•‘) ì •ë¦¬
- **QuerySet API** ë™ì‘(ì§€ì—° í‰ê°€, ì²´ì´ë‹, Manager) ë° CRUD ì‹¤ìŠµ
- **Field lookups**(exact/iexact, contains/icontains, gte/lt ë“±) íŒ¨í„´ ì •ë¦¬
- **ORM with view**ë¡œ ëª©ë¡ í˜ì´ì§€ êµ¬ì„±(ë·° â†’ í…œí”Œë¦¿ ë°ì´í„° íë¦„)

# ğŸ“š ë°°ìš´ ì 
- **ORM = ë²ˆì—­ì**: íŒŒì´ì¬ ì½”ë“œë¡œ ì‘ì„±í•œ ì§ˆì˜ë¥¼ SQLë¡œ ë³€í™˜í•˜ê³ , ê²°ê³¼ë¥¼ íŒŒì´ì¬ ê°ì²´/QuerySetìœ¼ë¡œ ë˜ëŒë ¤ì¤€ë‹¤.
- **QuerySetì€ ì§€ì—° í‰ê°€(lazy)**: ì‹¤ì œë¡œ í•„ìš”í•´ì§ˆ ë•Œ(ìˆœíšŒ/len()/ë¦¬ìŠ¤íŠ¸í™”/í…œí”Œë¦¿ ë Œë”ë§ ë“±) DBì— ì ‘ê·¼í•œë‹¤.
- **Manager (`objects`)**ë¥¼ í†µí•´ ì§ˆì˜ë¥¼ ì‹œì‘í•˜ê³ , **ì²´ì´ë‹**ìœ¼ë¡œ ì¡°ê±´ì„ ëˆ„ì í•œë‹¤(`filter().exclude().order_by()`).
- **get vs filter**: `get()`ì€ ë‹¨ì¼ ê°ì²´(ê³ ìœ  í‚¤)ì—ë§Œ ì•ˆì „, ì—†ê±°ë‚˜ ì—¬ëŸ¬ ê°œë©´ ì˜ˆì™¸. ë²”ìš© ì¡°íšŒëŠ” `filter()` ì‚¬ìš©.
- **Field lookups**ë¡œ SQL ë¹„êµ/ë¶€ë¶„ê²€ìƒ‰ì„ íŒŒì´ì¬ ë¬¸ë²•ìœ¼ë¡œ í‘œí˜„(`title__icontains="..."`, `id__gte=10`).

# ğŸ“Œ í•µì‹¬ ê°œë…
- **QuerySet ê¸°ë³¸ êµ¬ì¡°**: `Article.objects.all()` / `Article.objects.filter(title__icontains="...")`
- **CRUD ìš”ì•½**
  - Create: `Article(...).save()` / `Article.objects.create(...)`
  - Read: `all()`, `filter()`, `get()`, `order_by()`, `values()/values_list()`
  - Update: ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ ìˆ˜ì • í›„ `save(update_fields=[...])`
  - Delete: ì¸ìŠ¤í„´ìŠ¤ `delete()` / `QuerySet.delete()`
- **ì˜ˆì™¸**
  - `DoesNotExist`, `MultipleObjectsReturned` (ì£¼ë¡œ `get()` ì‚¬ìš© ì‹œ)
  - `IntegrityError` (NOT NULL, unique ì œì•½ ìœ„ë°˜)
- **ORM with view**
  - Viewì—ì„œ QuerySet ìƒì„± â†’ contextë¡œ í…œí”Œë¦¿ì— ì „ë‹¬ â†’ í…œí”Œë¦¿ì—ì„œ ë°˜ë³µ ì¶œë ¥

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ
```python
# articles/models.py (ì˜ˆì‹œ ëª¨ë¸)
from django.db import models

class Article(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.title
```

```python
# â”€â”€ Django shellì—ì„œ CRUD â”€â”€
from articles.models import Article
# Create
a = Article(title="first", content="hello")
a.save()                                # 1) ë¹ˆ ê°ì²´ í›„ save
Article.objects.create(title="second", content="world")  # 2) í•œ ë²ˆì— ìƒì„±

# Read
Article.objects.all()                   # ì „ì²´
Article.objects.filter(title__icontains="sec")   # ë¶€ë¶„ê²€ìƒ‰
Article.objects.filter(id__gte=2).order_by("-id")# ì •ë ¬
Article.objects.get(pk=1)               # ë‹¨ì¼(ì—†ê±°ë‚˜ ì—¬ëŸ¬ê°œë©´ ì˜ˆì™¸)

# Update
art = Article.objects.get(pk=1)
art.title = "first (edited)"
art.save(update_fields=["title"])

# Delete
art.delete()                            # ë‹¨ì¼ ì‚­ì œ
Article.objects.filter(title__icontains="old").delete()  # ì¼ê´„ ì‚­ì œ
```

```python
# â”€â”€ Field lookups ëª¨ìŒ â”€â”€
Article.objects.filter(title__exact="first")         # ëŒ€ì†Œë¬¸ì êµ¬ë¶„
Article.objects.filter(title__iexact="First")        # ëŒ€ì†Œë¬¸ì ë¬´ì‹œ
Article.objects.filter(title__startswith="fir")      # ì ‘ë‘
Article.objects.filter(title__icontains="st")        # í¬í•¨(ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
Article.objects.filter(id__range=(3, 10))            # êµ¬ê°„
Article.objects.filter(created_at__date__gte="2025-09-01")  # ë‚ ì§œ ë¹„êµ
```

```python
# â”€â”€ ORM with view â”€â”€  (ëª©ë¡ í˜ì´ì§€)
from django.shortcuts import render
from .models import Article

def index(request):
    articles = Article.objects.all().order_by("-id")   # ì§€ì—° í‰ê°€ â†’ í…œí”Œë¦¿ ë Œë”ë§ ì‹œ ì¿¼ë¦¬
    return render(request, "articles/index.html", {"articles": articles})
```

```html
<!-- templates/articles/index.html -->
{% extends "base.html" %}
{% block content %}
  <h1>Articles</h1>
  <ul>
  {% for a in articles %}
    <li>[{{ a.id }}] {{ a.title }} â€” {{ a.created_at|date:"Y-m-d H:i" }}</li>
  {% empty %}
    <li>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
  {% endfor %}
  </ul>
{% endblock %}
```

```python
# â”€â”€ ì•ˆì „í•œ get ì‚¬ìš© íŒ¨í„´ â”€â”€
from django.http import Http404
from django.shortcuts import get_object_or_404

# 1) try/except
try:
    obj = Article.objects.get(pk=pk)
except Article.DoesNotExist:
    raise Http404("í•´ë‹¹ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.")

# 2) í—¬í¼
obj = get_object_or_404(Article, pk=pk)
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| `DoesNotExist` ì˜ˆì™¸ | `get()`ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” PK ì¡°íšŒ | `get_object_or_404()` ì‚¬ìš© ë˜ëŠ” `filter().first()`ë¡œ ì•ˆì „ ì²˜ë¦¬ |
| `MultipleObjectsReturned` | `get()`ì— ìœ ì¼í•˜ì§€ ì•Šì€ ì¡°ê±´ ì‚¬ìš© | `filter()` ì‚¬ìš©, ë˜ëŠ” í•„ë“œì— `unique=True` ë¶€ì—¬ |
| `IntegrityError` (NOT NULL ë“±) | í•„ìˆ˜ í•„ë“œ ë¹„ìš°ê³  ì €ì¥ | ëª¨ë¸ ì˜µì…˜ ì¬ê²€í† (`null/blank/default`) í›„ ì €ì¥ |
| ì¿¼ë¦¬ ì„±ëŠ¥ ì €í•˜ | ë¬´ë¶„ë³„í•œ ìˆœíšŒ/í…œí”Œë¦¿ N+1 | `select_related()/prefetch_related()` ì ìš©, í•„ìš”í•œ í•„ë“œë§Œ `values()` |
| ì˜ëª»ëœ ì •ë ¬/ìŠ¬ë¼ì´ì‹± | ì¿¼ë¦¬ì…‹ í‰ê°€ íƒ€ì´ë° í˜¼ë™ | ì²´ì´ë‹ ìˆœì„œ ì ê²€(`order_by` í›„ `[:N]`), í•„ìš”í•œ ì‹œì ì—ë§Œ í‰ê°€ |

# ğŸ¯ ë‚´ì¼ í•  ì¼
- ğŸ“š `get_object_or_404`, `select_related/prefetch_related` ì‹¬í™” ë° N+1 ì‚¬ë¡€ ë¶„ì„
- ğŸ’» Article **CRUD** ì „ì²´ ë·°/í…œí”Œë¦¿ ì‘ì„±, URL ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì—°ê²°
- ğŸ” `values()/values_list()`ì™€ `annotate()`(ì§‘ê³„) ì—°ìŠµ, QuerySet ë””ë²„ê¹…(sqlprint) ìŠµê´€í™”
