# 2025-09-30 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- HTTPì˜ íŠ¹ì„±ê³¼ ë¬´ìƒíƒœì„± ë³´ì™„ì„ ìœ„í•œ **ì¿ í‚¤Â·ì„¸ì…˜ ë©”ì»¤ë‹ˆì¦˜** ì •ë¦¬
- Django **Authentication System**(ë¡œê·¸ì¸/ì„¸ì…˜/ì»¨í…ìŠ¤íŠ¸ í”„ë¡œì„¸ì„œ) íë¦„ í•™ìŠµ
- **Custom User Model(ëŒ€ì²´í˜•)**ë¡œ í”„ë¡œì íŠ¸ ì‹œì‘ ì‹œ ì„¤ì •í•´ì•¼ í•˜ëŠ” ì´ìœ  ë° ì ˆì°¨ ë³µê¸°
- ë¡œê·¸ì¸ í¼(AuthenticationForm) ê¸°ë°˜ **ë¡œê·¸ì¸ êµ¬í˜„ ì‹¤ìŠµ**
- ë¼ë””ì˜¤ ë²„íŠ¼ í‘œì‹œ ë° POST í‚¤ ë¶ˆì¼ì¹˜ë¡œ ì¸í•´ ê°’ì´ ì•ˆ ë„˜ì–´ê°€ë˜ **í¼ ì´ìŠˆ ë””ë²„ê¹…**

# ğŸ“š ë°°ìš´ ì 
- **HTTP = ë¹„ì—°ê²°(Connectionsless) + ë¬´ìƒíƒœ(Stateless)** â†’ ìƒíƒœ ìœ ì§€ë¥¼ ìœ„í•´ ì¿ í‚¤Â·ì„¸ì…˜ í•„ìš”
- **ì¿ í‚¤**: í´ë¼ì´ì–¸íŠ¸ ì €ì¥(Key-Value), `Set-Cookie`/`Cookie` í—¤ë”ë¡œ ì™•ë³µ, ë§Œë£Œ/ë„ë©”ì¸/ê²½ë¡œ ë“± ì†ì„±
- **ì„¸ì…˜**: ì„œë²„ ì €ì¥(ë©”ëª¨ë¦¬/DB), í´ë¼ì´ì–¸íŠ¸ëŠ” **ì„¸ì…˜IDë§Œ ì¿ í‚¤ì— ë³´ê´€**í•˜ì—¬ ì¸ì¦ ì§€ì†
- **Django ì„¸ì…˜**: ê¸°ë³¸ì´ DB ë°±ì—”ë“œ(`django_session`), ìš”ì²­ì˜ ì¿ í‚¤ì— ë‹´ê¸´ ì„¸ì…˜IDë¡œ ë§¤í•‘
- **Django Auth**: ì‚¬ìš©ì ëª¨ë¸, ì„¸ì…˜ê´€ë¦¬, ê¸°ë³¸ ì¸ì¦ í¼ ì œê³µ â†’ ë¡œê·¸ì¸ì€ â€œì¸ì¦ ì„±ê³µ â†’ ì„¸ì…˜ ë°œê¸‰/ì—°ê²°â€ì˜ ê³¼ì •
- **Custom User Model**ì€ í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ë°˜ë“œì‹œ ì§„í–‰(ë§ˆì´ê·¸ë ˆì´ì…˜ ì „) â†’ `AUTH_USER_MODEL = "accounts.User"`
- **context processors** ë•ë¶„ì— í…œí”Œë¦¿ì—ì„œ `user` ë“± ì¸ì¦ ê´€ë ¨ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥

# ğŸ“Œ í•µì‹¬ ê°œë…
- ì¿ í‚¤ vs ì„¸ì…˜
  - ì €ì¥ ìœ„ì¹˜: (ì¿ í‚¤) í´ë¼ / (ì„¸ì…˜) ì„œë²„
  - ë³´ì•ˆì„±: ì„¸ì…˜ì´ ìƒëŒ€ì ìœ¼ë¡œ ì•ˆì „(ë¯¼ê°ì •ë³´ëŠ” ì„œë²„ ë³´ê´€, í´ë¼ì—ëŠ” IDë§Œ)
  - ìˆ˜ëª…: ì„¸ì…˜ ì¿ í‚¤/ì˜ì† ì¿ í‚¤(Expires/Max-Age), ì„¸ì…˜ì€ ì„œë²„ ì •ì±…ì— ë”°ë¦„
- ì¿ í‚¤ ë³´ì•ˆ ì†ì„±: `HttpOnly`, `Secure`, `SameSite`, `Domain`, `Path`, `Expires/Max-Age`

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ

## 1) Django: ê°„ë‹¨ ì¿ í‚¤ ì„¤ì •/ì¡°íšŒ
```python
# views.py
from django.http import HttpResponse

def set_cart_cookie(request):
    resp = HttpResponse("cart set")
    # 1ì‹œê°„ ìœ ì§€(Max-Age=3600), JSì—ì„œ ì ‘ê·¼ ë¶ˆê°€(HttpOnly), HTTPSì—ì„œë§Œ ì „ì†¡(Secure)
    resp.set_cookie("cart", "A1001,B2002", max_age=3600, httponly=True, secure=True, samesite="Lax")
    return resp

def get_cart_cookie(request):
    cart = request.COOKIES.get("cart", "")
    return HttpResponse(f"cart={cart}")
```

## 2) Django: ë¡œê·¸ì¸(AuthenticationForm ì‚¬ìš©)
```python
# urls.py
from django.urls import path
from . import views
urlpatterns = [
    path("login/", views.login_view, name="login"),
    path("logout/", views.logout_view, name="logout"),
]
```
```python
# views.py
from django.contrib.auth.forms import AuthenticationForm
from django.contrib.auth import login, logout
from django.shortcuts import render, redirect

def login_view(request):
    if request.method == "POST":
        form = AuthenticationForm(request, data=request.POST)
        if form.is_valid():
            user = form.get_user()
            login(request, user)  # ì„¸ì…˜ ìƒì„± ë° ì—°ê²°
            return redirect("home")
    else:
        form = AuthenticationForm(request)
    return render(request, "accounts/login.html", {"form": form})

def logout_view(request):
    logout(request)  # ì„¸ì…˜ í•´ì œ
    return redirect("home")
```
```html
<!-- templates/accounts/login.html -->
<h1>ë¡œê·¸ì¸</h1>
<form method="post">
  {% csrf_token %}
  {{ form.as_p }}
  <button>ë¡œê·¸ì¸</button>
</form>
```

## 3) Custom User Model(ëŒ€ì²´)
```python
# accounts/models.py
from django.contrib.auth.models import AbstractUser
from django.db import models

class User(AbstractUser):
    # í™•ì¥ ì˜ˆì‹œ
    # birth_date = models.DateField(null=True, blank=True)
    pass
```
```python
# settings.py
AUTH_USER_MODEL = "accounts.User"
```
```python
# accounts/admin.py
from django.contrib import admin
from .models import User
admin.site.register(User)
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| í…œí”Œë¦¿ì—ì„œ **ë¼ë””ì˜¤ ë²„íŠ¼(ì£¼ì°¨ ê°€ëŠ¥ ì—¬ë¶€)**ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ | `<p for="...">`ì²˜ëŸ¼ `for`ê°€ ì˜ëª»ëœ ê³³ì— ìˆìŒ + `name` ì˜¤íƒ€(`is_parking_avaliable`) | `<label for="...">`ë§Œ ì‚¬ìš©í•˜ê³ , `<input id="...">`ì™€ ì§ ë§ì¶”ê¸°. `name="is_parking_available"`ë¡œ **POST í‚¤ë¥¼ ë·°ì™€ ì¼ì¹˜** |
| ë·°ì—ì„œ `request.POST.get('is_parking_available')`ê°€ í•­ìƒ `None` | í…œí”Œë¦¿ì˜ `name` ì†ì„± ì˜¤íƒ€ë¡œ í‚¤ ë¶ˆì¼ì¹˜ | í…œí”Œë¦¿ê³¼ ë·°ì˜ í‚¤ë¥¼ ë™ì¼í•˜ê²Œ(`is_parking_available`) í†µì¼ |
| Boolean ë¼ë””ì˜¤ ê°’ íŒŒì‹± ë¬¸ì œ | ë¼ë””ì˜¤ valueê°€ ë¬¸ìì—´ `"True"/"False"` | `ipa_raw in ['True','true','1','on']`ì²˜ëŸ¼ ì•ˆì „ ë³€í™˜ or `value="on"`/ì²´í¬ ì—¬ë¶€ë¡œ ì²˜ë¦¬ |

### ìˆ˜ì •ëœ í¼ ìŠ¤ë‹ˆí«
```html
<p>ì£¼ì°¨ ê°€ëŠ¥ ì—¬ë¶€</p>
<label for="is_parking_available_true">
  ê°€ëŠ¥
  <input type="radio" id="is_parking_available_true" name="is_parking_available" value="True">
</label>
<label for="is_parking_available_false">
  ë¶ˆê°€ëŠ¥
  <input type="radio" id="is_parking_available_false" name="is_parking_available" value="False">
</label>
```

### ìˆ˜ì •ëœ create ë·° ìŠ¤ë‹ˆí«
```python
ipa_raw = request.POST.get("is_parking_available")
is_parking_available = ipa_raw in ["True", "true", "1", "on"]
```

# ğŸ¯ ë‚´ì¼ í•  ì¼
- ğŸ“š Django Auth ì‹¬í™”: **ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ë„¤ë¹„ê²Œì´ì…˜/ì ‘ê·¼ ì œì–´**, `@login_required`, `next` íŒŒë¼ë¯¸í„° ì²˜ë¦¬
- ğŸ’» Custom Userì— **ì¶”ê°€ í•„ë“œ**(ì˜ˆ: ë‹‰ë„¤ì„/ìƒë…„ì›”ì¼) ì ìš© í›„ í¼/ë§ˆì´ê·¸ë ˆì´ì…˜/ì–´ë“œë¯¼ê¹Œì§€ ì—°ê²°
- ğŸ” ì¿ í‚¤ ë³´ì•ˆ ì†ì„± ì‹¤í—˜: `HttpOnly/Secure/SameSite` ì¡°í•©ë³„ ë¸Œë¼ìš°ì € ë™ì‘ ê´€ì°°
- ğŸ§ª ì„¸ì…˜ ë§Œë£Œ/ë¡œê·¸ì•„ì›ƒ/ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ë™ì‘ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

# ì°¸ê³ 
- Django ê³µì‹ë¬¸ì„œ: https://docs.djangoproject.com/en/5.2/topics/auth/customizing/#substituting-a-custom-user-model
