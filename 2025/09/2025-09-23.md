# 2025-09-23 TIL

# ✅ 오늘 한 일
- Django **Model/ORM**의 역할과 구조 정리(프로젝트–앱–URLs–Views–Models–Templates 연계)
- **Model Field**(types/options)와 제약 조건(null, blank, default) 학습
- **Migrations** 파이프라인(makemigrations → migrate) 및 추가 필드 케이스 실습
- **Admin site** 설정/사용법과 **SQLite** 사용 시 주의점 정리

# 📚 배운 점
- **Model = DB 테이블의 파이썬 추상화**: 클래스(필드) ↔ 테이블(컬럼) 일대일 매핑, 인스턴스 ↔ 레코드
- `models.Model`을 **상속**하면 ORM 기능(DDL/DML)이 제공되고, `id` 기본 PK는 자동 생성
- **Field types**는 저장할 데이터의 **종류**, **Field options**는 필드의 **동작/제약**을 규정
  - `CharField(max_length=...)`는 길이 제한, `TextField()`는 대용량 텍스트(길이 제한 실질적 없음)
  - 날짜/시간: `DateField / DateTimeField (auto_now, auto_now_add)`
- **null vs blank**
  - `null=True` → DB 차원에서 NULL 허용
  - `blank=True` → 폼/유효성 검사 레벨에서 빈값 허용 (관리자/폼 입력과 관련)
- **Migrations**: 모델 변경 → **설계도 생성**(makemigrations) → **DB 반영**(migrate). 기존 테이블에 **비NULL 필드 추가** 시 기본값 요구 프롬프트 발생
- **Admin**: `createsuperuser` 후 `admin.site.register(Model)` 해야 목록/CRUD 노출
- **SQLite**: 파일 기반(`db.sqlite3`)이므로 **.gitignore**에 제외, 환경 이동은 `migrations` + `fixtures`/`initial data`로 처리

# 📌 핵심 개념
- **Model 클래스 작성**
  - 필드명 = 컬럼명, `models.<FieldType>(옵션들)`
  - 제약 조건은 **DB/폼** 레이어를 구분(null vs blank)
- **Migrations 흐름**
  - 모델 수정 → `makemigrations`(설계도) → `migrate`(DDL 실행)
  - 추가 필드가 **nullable 아님**이면 기본값 지정 또는 `default=`/`null=True` 설계 필요
- **Admin 등록**
  - `admin.py`에서 모델 등록해야 화면에 표시
- **DB 초기화(학습용)**: `migrations/` 개별 파일 + `db.sqlite3` 삭제 후 재생성(실무에선 신중)

# 💡 예시 코드
```python
# articles/models.py
from django.db import models

class Article(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    # 생성/수정 시각
    created_at = models.DateTimeField(auto_now_add=True)  # 최초 생성 시 1회 기록
    updated_at = models.DateTimeField(auto_now=True)      # 저장(save)될 때마다 갱신

    def __str__(self):
        return self.title
```

```bash
# 마이그레이션 파이프라인
python manage.py makemigrations
python manage.py migrate

# 추가 명령
python manage.py showmigrations         # 적용 여부 확인
python manage.py sqlmigrate articles 0001  # SQL로 확인
```

```python
# admin.py
from django.contrib import admin
from .models import Article

@admin.ModelAdmin.register(Article)  # 또는 admin.site.register(Article)
class ArticleAdmin(admin.ModelAdmin):
    list_display = ("id", "title", "created_at", "updated_at")
    search_fields = ("title", "content")
```

```text
# .gitignore (발췌)
db.sqlite3
venv/
__pycache__/
*.pyc
```

# 🛠️ 이슈 & 해결
| 🐞 문제 상황 | 🔍 원인 | 💡 해결 방법 |
|--------------|--------|--------------|
| IntegrityError: NOT NULL constraint failed | 필수 필드에 값 없이 save | `null/blank` 설계 재검토 또는 값 채워 저장 |
| You are trying to add a non-nullable field... | 기존 테이블에 비NULL 새 필드 추가 | `default` 제공 or `null=True`로 설계 수정 후 마이그레이션 |
| no such table: app_model | 마이그레이션 미적용 | `makemigrations` 후 `migrate` 실행 |
| Admin에 모델이 안 보임 | `admin.site.register` 누락 또는 앱 미등록 | `admin.py` 등록, `INSTALLED_APPS`에 앱 추가 |
| 필드 길이/타입 불일치 에러 | `max_length` 부족·타입 설계 오류 | 필드 타입/옵션 재설계 → 새 마이그레이션 생성/적용 |

# 🎯 내일 할 일
- 📚 ORM 기본 연산(CRUD, `QuerySet` 필터링/정렬/슬라이싱) 정리 및 쉘 실습
- 💻 Article CRUD 뷰/템플릿 작성 & URL 매핑(네임스페이스 포함)
- 🔍 마이그레이션 분기/리네임·데이터 마이그레이션 실습, Admin 커스터마이징(list_filter, ordering)
