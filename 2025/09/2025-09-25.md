# 2025-09-25 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- Django **CRUD(READ/CREATE/UPDATE/DELETE)** íë¦„ì„ ì‹¤ì œ ë·°Â·í…œí”Œë¦¿ë¡œ êµ¬í˜„
- **HTTP ë©”ì„œë“œ(GET/POST)** ì˜ë¯¸ì™€ ì‚¬ìš© ì›ì¹™, **CSRF**ì™€ **PRG(Postâ†’Redirectâ†’Get)** í•™ìŠµ
- ë‹¨ì¼ ê¸€ ì¡°íšŒ(detail), ìƒˆ ê¸€ ì‘ì„±(new/create), ìˆ˜ì •(edit/update), ì‚­ì œ(delete) ì „ ê³¼ì •ì„ ì—°ê²°

# ğŸ“š ë°°ìš´ ì 
- **GET**ì€ ì¡°íšŒ(ì•ˆì „Â·ìºì‹œ ê°€ëŠ¥), **POST**ëŠ” ìƒíƒœ ë³€ê²½(ìƒì„±Â·ìˆ˜ì •Â·ì‚­ì œ, ìºì‹œ X) â€” ì˜ë¯¸ì— ë§ê²Œ ì‚¬ìš©.
- **CSRF í† í°**ì€ DBì— ì˜í–¥ì„ ì£¼ëŠ” ìš”ì²­(POST ë“±)ì—ì„œ í•„ìˆ˜. ëˆ„ë½ ì‹œ 403 Forbidden.
- **PRG íŒ¨í„´**ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ì¤‘ë³µ ì œì¶œ ë°©ì§€: POST ì²˜ë¦¬ í›„ **redirect**ë¡œ GETì„ ìœ ë„(ë³´í†µ 302).
- Djangoì—ì„œëŠ” **íŒŒê´´ì  ì‘ì—…ì„ GETìœ¼ë¡œ í•˜ì§€ ì•ŠëŠ”ë‹¤** â†’ ì‚­ì œ/ìˆ˜ì •ì€ ë°˜ë“œì‹œ **POST** í¼ìœ¼ë¡œ ì „ì†¡.

# ğŸ“Œ í•µì‹¬ ê°œë…
- **ë‹¨ì¼ ì¡°íšŒ(Detail)**: `get_object_or_404()`ë¡œ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì™€ ë Œë”.
- **Create**: `request.method == 'POST'`ì—ì„œë§Œ ìƒì„± ì²˜ë¦¬ â†’ ì„±ê³µ ì‹œ `redirect('articles:detail', pk=...)`.
- **Delete**: POST í¼ìœ¼ë¡œ ì „ì†¡ + CSRF í† í° â†’ ì„±ê³µ ì‹œ ëª©ë¡ìœ¼ë¡œ redirect.
- **Update**: `edit`(GET)ì—ì„œ ê¸°ì¡´ ê°’ ì±„ì›Œ ë Œë”, `update`(POST)ì—ì„œ ì €ì¥ í›„ redirect.
- **ì…ë ¥ ì±„ìš°ê¸° íŒ**: `input`ì€ `value` ì†ì„±, `textarea`ëŠ” **íƒœê·¸ ì‚¬ì´**ì— í…ìŠ¤íŠ¸.

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ

```python
# articles/urls.py
from django.urls import path
from . import views

app_name = "articles"
urlpatterns = [
    path("", views.index, name="index"),
    path("<int:pk>/", views.detail, name="detail"),
    path("new/", views.new, name="new"),
    path("create/", views.create, name="create"),          # POST ì „ìš©
    path("<int:pk>/delete/", views.delete, name="delete"), # POST ì „ìš©
    path("<int:pk>/edit/", views.edit, name="edit"),
    path("<int:pk>/update/", views.update, name="update"), # POST ì „ìš©
]
```

```python
# articles/views.py
from django.shortcuts import render, redirect, get_object_or_404
from .models import Article

def index(request):
    articles = Article.objects.all().order_by("-id")
    return render(request, "articles/index.html", {"articles": articles})

def detail(request, pk):
    article = get_object_or_404(Article, pk=pk)
    return render(request, "articles/detail.html", {"article": article})

def new(request):
    return render(request, "articles/new.html")

def create(request):
    if request.method != "POST":
        return redirect("articles:new")
    title = request.POST.get("title", "").strip()
    content = request.POST.get("content", "").strip()
    article = Article.objects.create(title=title, content=content)
    # PRG: ìƒì„± í›„ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    return redirect("articles:detail", pk=article.pk)

def delete(request, pk):
    article = get_object_or_404(Article, pk=pk)
    if request.method == "POST":
        article.delete()
        return redirect("articles:index")
    return redirect("articles:detail", pk=pk)

def edit(request, pk):
    article = get_object_or_404(Article, pk=pk)
    return render(request, "articles/edit.html", {"article": article})

def update(request, pk):
    article = get_object_or_404(Article, pk=pk)
    if request.method != "POST":
        return redirect("articles:edit", pk=pk)
    article.title = request.POST.get("title", article.title).strip()
    article.content = request.POST.get("content", article.content).strip()
    article.save(update_fields=["title", "content"])
    return redirect("articles:detail", pk=pk)
```

```html
<!-- templates/articles/index.html -->
{% extends "base.html" %}
{% block content %}
  <h1>Articles</h1>
  <p><a href="{% url 'articles:new' %}">ìƒˆ ê¸€ ì‘ì„±</a></p>
  <ul>
    {% for a in articles %}
      <li>
        <a href="{% url 'articles:detail' a.pk %}">[{{ a.id }}] {{ a.title }}</a>
        <form action="{% url 'articles:delete' a.pk %}" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit">ì‚­ì œ</button>
        </form>
      </li>
    {% empty %}
      <li>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
    {% endfor %}
  </ul>
{% endblock %}
```

```html
<!-- templates/articles/detail.html -->
{% extends "base.html" %}
{% block content %}
  <h1>{{ article.title }}</h1>
  <p>{{ article.content|linebreaksbr }}</p>
  <p>
    <a href="{% url 'articles:edit' article.pk %}">ìˆ˜ì •</a> |
    <a href="{% url 'articles:index' %}">ëª©ë¡</a>
  </p>
  <form action="{% url 'articles:delete' article.pk %}" method="post">
    {% csrf_token %}
    <button type="submit">ì‚­ì œ</button>
  </form>
{% endblock %}
```

```html
<!-- templates/articles/new.html -->
{% extends "base.html" %}
{% block content %}
  <h1>ìƒˆ ê¸€</h1>
  <form action="{% url 'articles:create' %}" method="post">
    {% csrf_token %}
    <div>
      <label>ì œëª©</label>
      <input type="text" name="title" required />
    </div>
    <div>
      <label>ë‚´ìš©</label>
      <textarea name="content" rows="6" required></textarea>
    </div>
    <button type="submit">ì‘ì„±</button>
  </form>
{% endblock %}
```

```html
<!-- templates/articles/edit.html -->
{% extends "base.html" %}
{% block content %}
  <h1>ìˆ˜ì •: {{ article.title }}</h1>
  <form action="{% url 'articles:update' article.pk %}" method="post">
    {% csrf_token %}
    <div>
      <label>ì œëª©</label>
      <input type="text" name="title" value="{{ article.title }}" required />
    </div>
    <div>
      <label>ë‚´ìš©</label>
      <textarea name="content" rows="6" required>{{ article.content }}</textarea>
    </div>
    <button type="submit">ì €ì¥</button>
  </form>
{% endblock %}
```

```text
# HTTP ìƒíƒœ ì½”ë“œ ìš”ì•½
200 OK       â€” ì •ìƒ ì‘ë‹µ
302 Found    â€” redirect ì‘ë‹µ(PRGì—ì„œ POST í›„ GET ìœ ë„)
403 Forbiddenâ€” CSRF ëˆ„ë½/ê¶Œí•œ ë¶€ì¡±
405 Method Not Allowed â€” ë¼ìš°íŒ…ì€ ë§ì§€ë§Œ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë©”ì„œë“œ
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| ìƒˆ ê¸€ POSTì— 403 ë°œìƒ | CSRF í† í° ëˆ„ë½ | í…œí”Œë¦¿ í¼ì— `{% csrf_token %}` ì¶”ê°€, ê¸°ë³¸ ë¯¸ë“¤ì›¨ì–´ ìœ ì§€ |
| ìƒˆë¡œê³ ì¹¨ ì‹œ ì¤‘ë³µ ìƒì„± | POST í›„ ë°”ë¡œ í…œí”Œë¦¿ ì‘ë‹µ | **PRG íŒ¨í„´** ì‚¬ìš© â†’ `redirect()`ë¡œ ìƒì„¸/ëª©ë¡ GET ìœ ë„ |
| ì‚­ì œë¥¼ ë§í¬ë¡œ ì²˜ë¦¬ | GETìœ¼ë¡œ íŒŒê´´ì  ì‘ì—… | **POST í¼ + CSRF**ë¡œë§Œ ì‚­ì œ ìˆ˜í–‰ |
| ìˆ˜ì • í¼ì— ê¸°ì¡´ ë‚´ìš© ë¯¸í‘œì‹œ | input/textarea ì±„ìš°ëŠ” ë°©ì‹ í˜¼ë™ | inputì€ `value`, textareaëŠ” **íƒœê·¸ ì‚¬ì´**ì— ê°’ |
| 405 Method Not Allowed | URLì€ ë§ëŠ”ë° ë©”ì„œë“œ ë¶ˆì¼ì¹˜ | í¼ `method` í™•ì¸, ë·°ì—ì„œ `request.method` ë¶„ê¸°/ë¦¬ë‹¤ì´ë ‰íŠ¸ |

# ğŸ¯ ë‚´ì¼ í•  ì¼
- ğŸ“š Django **Form/ModelForm**ë¡œ ì…ë ¥ ê²€ì¦Â·ë Œë”ë§ ìë™í™”, ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
- ğŸ’» ë©”ì‹œì§€ í”„ë ˆì„ì›Œí¬(`django.contrib.messages`)ë¡œ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ì•Œë¦¼ UX ê°œì„ 
- ğŸ” ì‚­ì œ í™•ì¸ í˜ì´ì§€/ëª¨ë‹¬ ì ìš©, ê¶Œí•œ(ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ì“°ê¸°) ë°ì½”ë ˆì´í„° ì ìš©
