# 2025-10-01 TIL

# âœ… ì˜¤ëŠ˜ í•œ ì¼
- Django ì¸ì¦ ì „ë°˜(ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ/íšŒì›ê°€ì…/íšŒì›ì •ë³´ ìˆ˜ì •/ë¹„ë°€ë²ˆí˜¸ ë³€ê²½/ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”) íë¦„ ë³µìŠµ ë° ì½”ë“œ ì •ë¦¬
- Custom User Model(`AbstractUser`) ì ìš©ì— ë”°ë¥¸ Form ì»¤ìŠ¤í„°ë§ˆì´ì§• ì‹¤ìŠµ
- ì„¸ì…˜/ì¿ í‚¤ ë™ì‘ê³¼ ë³´ì•ˆ(í•´ì‹œ, ì†”íŠ¸, ë ˆì¸ë³´ìš° í…Œì´ë¸”, Brute-force, Key Stretching) ê°œë… ì •ë¦¬

# ğŸ“š ë°°ìš´ ì 
- ë¡œê·¸ì¸ì€ *ì¸ì¦ â†’ ì„¸ì…˜ ìƒì„± â†’ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°*ì˜ íë¦„ì´ë©°, DjangoëŠ” `AuthenticationForm` + `login(request, user)`ë¡œ ì²˜ë¦¬
- ë¡œê·¸ì•„ì›ƒì€ *ì„¸ì…˜ ë°ì´í„° ì‚­ì œ + ì„¸ì…˜ ì¿ í‚¤ ì‚­ì œ*ë¡œ êµ¬í˜„ë˜ë©°, ë°˜ë“œì‹œ POST ìš”ì²­ ë° CSRF ë³´í˜¸ ì ìš©
- ê¸°ë³¸ Userë¥¼ ëŒ€ì²´(`AUTH_USER_MODEL`)í•˜ë©´ `UserCreationForm`/`UserChangeForm`ì€ ì§ì ‘ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•„ìš”
- ì¸ì¦ ìƒíƒœ ì œì–´: `is_authenticated`(ì†ì„±), `login_required`(ë°ì½”ë ˆì´í„°)ë¡œ ë·° ì ‘ê·¼ì„ ì¡°ì ˆ
- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ ì„¸ì…˜ ë¬´íš¨í™”ëŠ” `update_session_auth_hash`ë¡œ ë°©ì§€
- ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ: í•´ì‹œ + ì†”íŠ¸ + í‚¤ ìŠ¤íŠ¸ë ˆì¹­(PBKDF2/Argon2/bcrypt)ì„ í†µí•´ ë ˆì¸ë³´ìš° í…Œì´ë¸”Â·ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²© ëŒ€ì‘
- Djangoì˜ ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”ëŠ” `django.contrib.auth.urls`ë¡œ ë¹ ë¥´ê²Œ êµ¬ì„± ê°€ëŠ¥(ì½˜ì†” ì´ë©”ì¼ ë°±ì—”ë“œë¡œ í…ŒìŠ¤íŠ¸)

# ğŸ“Œ í•µì‹¬ ê°œë…
- **ì„¸ì…˜ & ì¿ í‚¤**: ì„œë²„ ìƒíƒœ(stateless) ë³´ì™„ì„ ìœ„í•´ ì„¸ì…˜IDë¥¼ ì¿ í‚¤ë¡œ ë³´ê´€, ì„œë²„ëŠ” ì„¸ì…˜ ì €ì¥ì†Œì—ì„œ ì‚¬ìš©ì ìƒíƒœ ê´€ë¦¬
- **AuthenticationForm**: ì¸ì¦ ì „ìš© *Form*, ìœ íš¨ì„± í†µê³¼ í›„ `.get_user()`ë¡œ ì‚¬ìš©ì ê°ì²´ íšë“ â†’ `login(request, user)`
- **AbstractUser**: ê´€ë¦¬ì ê¶Œí•œ ë“± í•„ë“œë¥¼ í¬í•¨í•œ ì™„ì „í•œ ì‚¬ìš©ì ëª¨ë¸ì˜ *ì¶”ìƒ ê¸°ë³¸ í´ë˜ìŠ¤*
- **get_user_model()**: í˜„ì¬ í™œì„± ì‚¬ìš©ì ëª¨ë¸ ë°˜í™˜(ì§ì ‘ `User` ì°¸ì¡° ì§€ì–‘)
- **is_authenticated**: ì½ê¸° ì „ìš© ì†ì„±(True/False). ë©”ë‰´ ë…¸ì¶œ/ê¶Œí•œ ë¶„ê¸°ì— ì‚¬ìš©
- **login_required**: ë¹„ì¸ì¦ ì‚¬ìš©ìë¥¼ `/accounts/login/`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- **ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” íŒŒì´í”„ë¼ì¸**
  - í•´ì‹œ(Hash) â†’ ì†”íŠ¸(Salt) â†’ í‚¤ ìŠ¤íŠ¸ë ˆì¹­(PBKDF2 ê¸°ë³¸, Argon2/bcrypt ê°€ëŠ¥)
  - Django í•´ì‹œ í¬ë§·: `algorithm$iterations$salt$hash`

# ğŸ’¡ ì˜ˆì‹œ ì½”ë“œ

```python
# urls.py (accounts ì•±)
from django.urls import path
from . import views

app_name = "accounts"
urlpatterns = [
    path("login/", views.login_view, name="login"),
    path("logout/", views.logout_view, name="logout"),
    path("signup/", views.signup, name="signup"),
    path("update/", views.update, name="update"),
    path("password/", views.change_password, name="password"),
    path("delete/", views.delete, name="delete"),
]
```

```python
# forms.py (Custom User ëª¨ë¸ ëŒ€ì‘)
from django.contrib.auth import get_user_model
from django.contrib.auth.forms import UserCreationForm, UserChangeForm

User = get_user_model()

class CustomUserCreationForm(UserCreationForm):
    class Meta(UserCreationForm.Meta):
        model = User
        fields = ("username", "email")

class CustomUserChangeForm(UserChangeForm):
    class Meta(UserChangeForm.Meta):
        model = User
        fields = ("email",)  # ë¯¼ê° í•„ë“œëŠ” ì œì™¸
```

```python
# views.py (login/logout)
from django.contrib.auth import login, logout
from django.contrib.auth.forms import AuthenticationForm
from django.shortcuts import render, redirect

def login_view(request):
    if request.user.is_authenticated:
        return redirect("home")
    if request.method == "POST":
        form = AuthenticationForm(request, data=request.POST)
        if form.is_valid():
            user = form.get_user()
            login(request, user)
            return redirect("home")
    else:
        form = AuthenticationForm()
    return render(request, "accounts/login.html", {"form": form})

def logout_view(request):
    if request.method == "POST":
        logout(request)
        return redirect("home")
    return render(request, "accounts/logout.html")  # POSTë¡œ ì œì¶œí•˜ëŠ” ë²„íŠ¼ ì œê³µ
```

```python
# views.py (signup/update/delete)
from django.contrib.auth.decorators import login_required
from .forms import CustomUserCreationForm, CustomUserChangeForm

def signup(request):
    if request.user.is_authenticated:
        return redirect("home")
    if request.method == "POST":
        form = CustomUserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)  # íšŒì›ê°€ì… í›„ ìë™ ë¡œê·¸ì¸
            return redirect("home")
    else:
        form = CustomUserCreationForm()
    return render(request, "accounts/signup.html", {"form": form})

@login_required
def update(request):
    if request.method == "POST":
        form = CustomUserChangeForm(request.POST, instance=request.user)
        if form.is_valid():
            form.save()
            return redirect("home")
    else:
        form = CustomUserChangeForm(instance=request.user)
    return render(request, "accounts/update.html", {"form": form})

@login_required
def delete(request):
    if request.method == "POST":
        user = request.user
        user.delete()
        # ì£¼ì˜: íƒˆí‡´ í›„ logout(request) í˜¸ì¶œ (ìˆœì„œ ì¤‘ìš”)
        # ì—¬ê¸°ì„œëŠ” user.delete() ì§í›„ request.userëŠ” Anonymousê°€ ë˜ë¯€ë¡œ,
        # ë³„ë„ ì²˜ë¦¬ ì—†ì´ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ê±°ë‚˜ ì„¸ì…˜ì„ ì •ë¦¬í•˜ëŠ” íë¦„ ìœ ì§€
        return redirect("home")
    return render(request, "accounts/delete.html")
```

```python
# views.py (password change)
from django.contrib.auth.forms import PasswordChangeForm
from django.contrib.auth import update_session_auth_hash

@login_required
def change_password(request):
    if request.method == "POST":
        form = PasswordChangeForm(request.user, request.POST)
        if form.is_valid():
            user = form.save()
            update_session_auth_hash(request, user)  # ì„¸ì…˜ ë¬´íš¨í™” ë°©ì§€
            return redirect("home")
    else:
        form = PasswordChangeForm(request.user)
    return render(request, "accounts/password.html", {"form": form})
```

```python
# í”„ë¡œì íŠ¸ urls.py ì— auth URL í¬í•¨(ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ë“±)
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path("admin/", admin.site.urls),
    path("accounts/", include("accounts.urls")),
    path("accounts/", include("django.contrib.auth.urls")),  # password_reset ë“±
]
```

```python
# settings.py (ì´ë©”ì¼ ì½˜ì†” ë°±ì—”ë“œë¡œ ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸)
EMAIL_BACKEND = "django.core.mail.backends.console.EmailBackend"
```

# ğŸ› ï¸ ì´ìŠˆ & í•´ê²°
| ğŸ ë¬¸ì œ ìƒí™© | ğŸ” ì›ì¸ | ğŸ’¡ í•´ê²° ë°©ë²• |
|--------------|--------|--------------|
| ì»¤ìŠ¤í…€ ìœ ì € ì‚¬ìš© ì‹œ íšŒì›ê°€ì… ì—ëŸ¬: â€œManager isnâ€™t availableâ€¦ â€˜auth.Userâ€™ has been swapped for â€˜accounts.Userâ€™â€ | ê¸°ë³¸ `UserCreationForm`ê°€ ë‚´ ì»¤ìŠ¤í…€ User ëª¨ë¸ì´ ì•„ë‹Œ ê³¼ê±° ê¸°ë³¸ Userì— ì˜ì¡´ | `get_user_model()` ê¸°ë°˜ìœ¼ë¡œ `CustomUserCreationForm` ì‘ì„± í›„ êµì²´ |
| ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í›„ ë¡œê·¸ì•„ì›ƒë¨ | ì„¸ì…˜ì˜ ì¸ì¦ í•´ì‹œì™€ ë³€ê²½ëœ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œê°€ ë¶ˆì¼ì¹˜ | `update_session_auth_hash(request, user)` í˜¸ì¶œë¡œ ê¸°ì¡´ ì„¸ì…˜ì„ ìƒˆ í•´ì‹œë¡œ ê°±ì‹  |
| ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ GET ìš”ì²­ ë…¸ì¶œ | CSRF ë° ì˜ë„ì¹˜ ì•Šì€ íŠ¸ë¦¬ê±° ìœ„í—˜ | í¼ìœ¼ë¡œ POST ì „ì†¡ë§Œ í—ˆìš©, í…œí”Œë¦¿ì— csrf_token í¬í•¨ |
| ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ ë¯¼ê° í•„ë“œ ë…¸ì¶œ | `UserChangeForm` ê¸°ë³¸ í•„ë“œ ê³¼ë‹¤ | í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ ë…¸ì¶œ(ì˜ˆ: email)ë¡œ Meta.fields ì¬ì •ì˜ |

# ğŸ¯ ë‚´ì¼ í•  ì¼
- ğŸ“š `PermissionRequiredMixin`, ê·¸ë£¹/í¼ë¯¸ì…˜ ëª¨ë¸ë§, ê°ì²´ ë‹¨ìœ„ ê¶Œí•œ(ì˜ˆ: ì‘ì„±ìë§Œ ìˆ˜ì •/ì‚­ì œ) ì‹¤ìŠµ
- ğŸ’» ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” í…œí”Œë¦¿ ì»¤ìŠ¤í„°ë§ˆì´ì§•(ì´ë©”ì¼/ì™„ë£Œ í™”ë©´), Argon2 ì„¤ì • ì ìš© ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ê²€í† 
