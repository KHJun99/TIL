# 2025-10-02 TIL

# ✅ 오늘 한 일
- Django Model Fields & Forms 학습
- AbstractUser를 활용한 커스텀 User 모델 구현
- choices 속성을 사용한 드롭다운 메뉴 생성
- MultipleChoiceField를 활용한 다중 선택 폼 구현
- cleaned_data의 동작 원리와 활용 방법 학습

# 📚 배운 점
- **AbstractUser**: Django의 기본 User 모델을 상속받아 커스텀 필드를 추가할 수 있는 가장 표준적인 방법
- **choices 속성**: DB에는 코드 값을 저장하고, 사용자에게는 이해하기 쉬운 레이블을 보여주는 기능
- **blank vs null**: blank는 Form 유효성 검사 레벨, null은 DB 레벨에서 동작하는 서로 다른 속성
- **cleaned_data**: form.is_valid() 통과 후 접근 가능하며, 자동으로 적절한 파이썬 타입으로 변환된 검증된 데이터

# 📌 핵심 개념
- **choices 변수명 규칙**: STATUS_CHOICES처럼 전체 대문자로 명명 (PEP 8의 상수 명명 규칙)
- **PositiveIntegerField**: 0을 포함한 양의 정수만 저장 가능하도록 제한하여 데이터 무결성 보장
- **문자열 필드의 null=True 비권장**: 빈 값을 나타내는 상태가 NULL과 빈 문자열('')로 두 가지가 되어 혼란 발생
- **MultipleChoiceField**: 여러 선택지를 동시에 선택 가능하며, 결과는 리스트 형태로 전달됨

# 💡 예시 코드

**AbstractUser 커스터마이징**
```python
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
    nickname = models.CharField(max_length=30)
    profile_image = models.ImageField(upload_to='profile_pics/', blank=True)
    date_of_birth = models.DateField(null=True, blank=True)
```

**choices 속성 활용**
```python
class Todo(models.Model):
    STATUS_CHOICES = [
        ('TODO', '할 일'),
        ('DOING', '진행 중'),
        ('DONE', '완료'),
    ]
    
    status = models.CharField(
        max_length=5,
        choices=STATUS_CHOICES,
        default='TODO',
    )
```

**MultipleChoiceField 활용**
```python
class ProductForm(forms.ModelForm):
    CATEGORY_CHOICES = [
        ('ELEC', 'Electronics'),
        ('BOOK', 'Books'),
        ('FASH', 'Fashion'),
    ]
    
    category = forms.MultipleChoiceField(
        choices=CATEGORY_CHOICES,
        required=False,
        widget=forms.CheckboxSelectMultiple,
    )
```

**cleaned_data 활용**
```python
def form2(request):
    if request.method == 'POST':
        form = ProductForm(request.POST)
        if form.is_valid():
            product = form.save(commit=False)
            category_values = form.cleaned_data.get('category', [])
            category_string = ','.join(category_values)
            product.category = category_string
            product.save()
```

# 🛠️ 이슈 & 해결
| 🐞 문제 상황 | 🔍 원인 | 💡 해결 방법 |
|--------------|--------|--------------|
| MultipleChoiceField로 받은 데이터를 DB에 저장할 수 없음 | 리스트 형태로 전달되는 데이터를 CharField에 바로 저장 시도 | cleaned_data에서 리스트를 가져와 ','.join()으로 문자열로 변환 후 저장 |
| 문자열 필드에 blank=True만 설정 시 빈 값 저장 실패 | null=True도 함께 설정하여 NULL과 빈 문자열 두 가지 상태 발생 | 문자열 필드는 blank=True만 사용하고 null=True 제거 (빈 문자열로 통일) |